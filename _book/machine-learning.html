<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Machine learning with soil XRPD data | Digital Soil Mineralogy with R</title>
  <meta name="description" content="An online course detailing various methods for data-driven analysis of X-ray powder diffraction using R" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Machine learning with soil XRPD data | Digital Soil Mineralogy with R" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/figures/dsm_graphic.png" />
  <meta property="og:description" content="An online course detailing various methods for data-driven analysis of X-ray powder diffraction using R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Machine learning with soil XRPD data | Digital Soil Mineralogy with R" />
  
  <meta name="twitter:description" content="An online course detailing various methods for data-driven analysis of X-ray powder diffraction using R" />
  <meta name="twitter:image" content="/figures/dsm_graphic.png" />

<meta name="author" content="Benjamin Butler and Steve Hillier" />


<meta name="date" content="2022-07-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="quant.html"/>
<link rel="next" href="cluster-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/font-awesome-5.13.0/js/script.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/plotly-binding-4.9.4.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Digital Soil Mineralogy with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code-conventions"><i class="fa fa-check"></i>Code Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-expect"><i class="fa fa-check"></i>What to expect</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Working with XRPD data in R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#basic-form"><i class="fa fa-check"></i><b>1.1</b> The basic form of XRPD data</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#loading-data"><i class="fa fa-check"></i><b>1.2</b> Loading XRPD data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#powDLL"><i class="fa fa-check"></i><b>1.2.1</b> Option 1: PowDLL</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#loading-directly"><i class="fa fa-check"></i><b>1.2.2</b> Option 2: Loading directly into R</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#loading-multiple"><i class="fa fa-check"></i><b>1.2.3</b> Loading multiple files</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#plotting-data"><i class="fa fa-check"></i><b>1.3</b> Plotting XRPD data</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#plotting-xy-objects"><i class="fa fa-check"></i><b>1.3.1</b> Plotting <code>XY</code> objects</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#plotting-multixy-objects"><i class="fa fa-check"></i><b>1.3.2</b> Plotting <code>multiXY</code> objects</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#ggplot2-intro"><i class="fa fa-check"></i><b>1.3.3</b> Modifying plots with <strong>ggplot2</strong></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#manipulating-data"><i class="fa fa-check"></i><b>1.4</b> Manipulating XRPD data</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#subsetting"><i class="fa fa-check"></i><b>1.4.1</b> Subsetting XRPD data</a></li>
<li class="chapter" data-level="1.4.2" data-path="intro.html"><a href="intro.html#transformations"><i class="fa fa-check"></i><b>1.4.2</b> Transformations of count intensities</a></li>
<li class="chapter" data-level="1.4.3" data-path="intro.html"><a href="intro.html#interpolation"><i class="fa fa-check"></i><b>1.4.3</b> Interpolation</a></li>
<li class="chapter" data-level="1.4.4" data-path="intro.html"><a href="intro.html#alignment"><i class="fa fa-check"></i><b>1.4.4</b> Alignment</a></li>
<li class="chapter" data-level="1.4.5" data-path="intro.html"><a href="intro.html#background"><i class="fa fa-check"></i><b>1.4.5</b> Background fitting</a></li>
<li class="chapter" data-level="1.4.6" data-path="intro.html"><a href="intro.html#to-data-frame"><i class="fa fa-check"></i><b>1.4.6</b> Converting to and from data frames</a></li>
<li class="chapter" data-level="1.4.7" data-path="intro.html"><a href="intro.html#two-theta-transform"><i class="fa fa-check"></i><b>1.4.7</b> 2θ transformation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="quant.html"><a href="quant.html"><i class="fa fa-check"></i><b>2</b> Quantitative phase analysis</a>
<ul>
<li class="chapter" data-level="2.1" data-path="quant.html"><a href="quant.html#full-pattern-summation-with-powdr"><i class="fa fa-check"></i><b>2.1</b> Full pattern summation with <strong>powdR</strong></a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="quant.html"><a href="quant.html#powdRlib"><i class="fa fa-check"></i><b>2.1.1</b> The <code>powdRlib</code> object</a></li>
<li class="chapter" data-level="2.1.2" data-path="quant.html"><a href="quant.html#full-pattern-summation-with-fps"><i class="fa fa-check"></i><b>2.1.2</b> Full pattern summation with <code>fps()</code></a></li>
<li class="chapter" data-level="2.1.3" data-path="quant.html"><a href="quant.html#afps"><i class="fa fa-check"></i><b>2.1.3</b> Automated full pattern summation with <code>afps()</code></a></li>
<li class="chapter" data-level="2.1.4" data-path="quant.html"><a href="quant.html#additional-fps-and-afps-functionality"><i class="fa fa-check"></i><b>2.1.4</b> Additional <code>fps()</code> and <code>afps()</code> functionality</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="quant.html"><a href="quant.html#plotting-powdrfps-and-powdrafps-objects"><i class="fa fa-check"></i><b>2.2</b> Plotting <code>powdRfps</code> and <code>powdRafps</code> objects</a></li>
<li class="chapter" data-level="2.3" data-path="quant.html"><a href="quant.html#quantifying-multiple-samples"><i class="fa fa-check"></i><b>2.3</b> Quantifying multiple samples</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="quant.html"><a href="quant.html#lapply"><i class="fa fa-check"></i><b>2.3.1</b> <code>lapply()</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="quant.html"><a href="quant.html#parallel-processing"><i class="fa fa-check"></i><b>2.3.2</b> Parallel processing</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="quant.html"><a href="quant.html#summarising-mineralogy"><i class="fa fa-check"></i><b>2.4</b> Summarising mineralogy</a></li>
<li class="chapter" data-level="2.5" data-path="quant.html"><a href="quant.html#the-powdr-shiny-app"><i class="fa fa-check"></i><b>2.5</b> The powdR Shiny app</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>3</b> Machine learning with soil XRPD data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="machine-learning.html"><a href="machine-learning.html#loading-packages-and-data"><i class="fa fa-check"></i><b>3.1</b> Loading packages and data</a></li>
<li class="chapter" data-level="3.2" data-path="machine-learning.html"><a href="machine-learning.html#cubist-exploration"><i class="fa fa-check"></i><b>3.2</b> Data exploration</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="machine-learning.html"><a href="machine-learning.html#spatial-data"><i class="fa fa-check"></i><b>3.2.1</b> Spatial data</a></li>
<li class="chapter" data-level="3.2.2" data-path="machine-learning.html"><a href="machine-learning.html#geochemical-data"><i class="fa fa-check"></i><b>3.2.2</b> Geochemical data</a></li>
<li class="chapter" data-level="3.2.3" data-path="machine-learning.html"><a href="machine-learning.html#xrpd-data"><i class="fa fa-check"></i><b>3.2.3</b> XRPD data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="machine-learning.html"><a href="machine-learning.html#cubist-pretreatment"><i class="fa fa-check"></i><b>3.3</b> Data pre-treatment</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="machine-learning.html"><a href="machine-learning.html#alignment-1"><i class="fa fa-check"></i><b>3.3.1</b> Alignment</a></li>
<li class="chapter" data-level="3.3.2" data-path="machine-learning.html"><a href="machine-learning.html#subsetting-1"><i class="fa fa-check"></i><b>3.3.2</b> Subsetting</a></li>
<li class="chapter" data-level="3.3.3" data-path="machine-learning.html"><a href="machine-learning.html#mean-centering"><i class="fa fa-check"></i><b>3.3.3</b> Mean centering</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="machine-learning.html"><a href="machine-learning.html#creation-of-training-and-test-datasets"><i class="fa fa-check"></i><b>3.4</b> Creation of training and test datasets</a></li>
<li class="chapter" data-level="3.5" data-path="machine-learning.html"><a href="machine-learning.html#using-cubist"><i class="fa fa-check"></i><b>3.5</b> Using Cubist</a></li>
<li class="chapter" data-level="3.6" data-path="machine-learning.html"><a href="machine-learning.html#inspection-of-cubist-models"><i class="fa fa-check"></i><b>3.6</b> Inspection of Cubist models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cluster-analysis.html"><a href="cluster-analysis.html"><i class="fa fa-check"></i><b>4</b> Cluster analysis of soil XRPD data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cluster-analysis.html"><a href="cluster-analysis.html#loading-packages-and-data-1"><i class="fa fa-check"></i><b>4.1</b> Loading packages and data</a></li>
<li class="chapter" data-level="4.2" data-path="cluster-analysis.html"><a href="cluster-analysis.html#clustering-pca"><i class="fa fa-check"></i><b>4.2</b> Principal component analysis</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="cluster-analysis.html"><a href="cluster-analysis.html#interpreting-principal-components"><i class="fa fa-check"></i><b>4.2.1</b> Interpreting principal components</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="cluster-analysis.html"><a href="cluster-analysis.html#fuzzy-clustering"><i class="fa fa-check"></i><b>4.3</b> Fuzzy clustering</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="cluster-analysis.html"><a href="cluster-analysis.html#cluster-membership"><i class="fa fa-check"></i><b>4.3.1</b> Cluster membership</a></li>
<li class="chapter" data-level="4.3.2" data-path="cluster-analysis.html"><a href="cluster-analysis.html#subsetting-clusters"><i class="fa fa-check"></i><b>4.3.2</b> Subsetting Clusters</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="cluster-analysis.html"><a href="cluster-analysis.html#exploring-results"><i class="fa fa-check"></i><b>4.4</b> Exploring results</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mars.html"><a href="mars.html"><i class="fa fa-check"></i><b>5</b> From Mars to Mull: Interplanetary comparison of soil XRPD data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="mars.html"><a href="mars.html#mars-package"><i class="fa fa-check"></i><b>5.1</b> Required packages</a></li>
<li class="chapter" data-level="5.2" data-path="mars.html"><a href="mars.html#datasets"><i class="fa fa-check"></i><b>5.2</b> Datasets</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="mars.html"><a href="mars.html#mars-data"><i class="fa fa-check"></i><b>5.2.1</b> Mars Science Laboratory XRPD Data</a></li>
<li class="chapter" data-level="5.2.2" data-path="mars.html"><a href="mars.html#mars-scotland-data"><i class="fa fa-check"></i><b>5.2.2</b> Scottish Soil XRPD data</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="mars.html"><a href="mars.html#mars-manipulation"><i class="fa fa-check"></i><b>5.3</b> Data manipulation</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="mars.html"><a href="mars.html#θ-transformation"><i class="fa fa-check"></i><b>5.3.1</b> 2θ transformation</a></li>
<li class="chapter" data-level="5.3.2" data-path="mars.html"><a href="mars.html#θ-interpolation"><i class="fa fa-check"></i><b>5.3.2</b> 2θ interpolation</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="mars.html"><a href="mars.html#comparison-of-xrpd-data"><i class="fa fa-check"></i><b>5.4</b> Comparison of XRPD data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Digital Soil Mineralogy with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="machine-learning" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Machine learning with soil XRPD data<a href="machine-learning.html#machine-learning" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter will demonstrate the use of the Cubist machine learning algorithm to predict and interpret soil properties from XRPD data. Cubist is an extension of Quinlan’s M5 model tree <span class="citation">(<a href="#ref-Quinlan1992" role="doc-biblioref">Quinlan 1992</a>)</span>, and is featured in the CRAN repository under the same name for use in the R statistical software environment <span class="citation">(<a href="#ref-R-Cubist" role="doc-biblioref">Kuhn and Quinlan 2022</a>)</span>. Cubist defines a series of conditions based on predictor variables (i.e. the XRPD measurement intervals) that partition the data. At each partition there is a multivariate linear model used to predict the output (i.e. the soil property).</p>
<p>The examples presented herein for the use of Cubist will use data from <span class="citation">Butler et al. (<a href="#ref-Butler2020" role="doc-biblioref">2020</a>)</span> that is hosted on Mendeley Data <a href="https://doi.org/10.17632/r6g94fgx55.1">here</a>. More specifically, to run the examples in this chapter on your own machine, you will need to download the soil property data in ‘.csv’ format and the XRPD data in a zipped folder of ‘xy’ files. Please simply save these files to your own directory, and unzip the zipped folder containing the ‘.xy’ files.</p>
<a href="https://data.mendeley.com/public-files/datasets/r6g94fgx55/files/9b742b95-c071-4e3a-a227-939efa034ac7/file_downloaded">
<button class="btn btn-danger"><i class="fa fa-save"></i> Download soil property csv</button>
</a>
<a href="https://data.mendeley.com/public-files/datasets/r6g94fgx55/files/ef33d276-e39c-4b64-b9aa-f2d1d69c51b3/file_downloaded">
<button class="btn btn-danger"><i class="fa fa-save"></i> Download zipped XRPD data</button>
</a>
<div id="loading-packages-and-data" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Loading packages and data<a href="machine-learning.html#loading-packages-and-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/BTZv9QE1n94" frameborder="0" allowfullscreen>
</iframe>
</p>
<p>This chapter will use a number of packages that should already be installed on your machine, but will also use the <strong>leaflet</strong> and <strong>Cubist</strong> packages that may need to be installed if you have not used them before:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="machine-learning.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install packages that haven&#39;t been used on this course so far</span></span>
<span id="cb136-2"><a href="machine-learning.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;leaflet&quot;</span> and <span class="st">&quot;Cubist&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="machine-learning.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load the relevant packages</span></span>
<span id="cb137-2"><a href="machine-learning.html#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(powdR)</span>
<span id="cb137-3"><a href="machine-learning.html#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb137-4"><a href="machine-learning.html#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb137-5"><a href="machine-learning.html#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Cubist)</span>
<span id="cb137-6"><a href="machine-learning.html#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code></pre></div>
<p>Once you have loaded the packages and downloaded the data required for this chapter, the data can be loaded into R by modifying the paths in the following code:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="machine-learning.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the soil property data</span></span>
<span id="cb138-2"><a href="machine-learning.html#cb138-2" aria-hidden="true" tabindex="-1"></a>props <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">&quot;path/to/your/file/clusters_and_properties.csv&quot;</span>)</span>
<span id="cb138-3"><a href="machine-learning.html#cb138-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-4"><a href="machine-learning.html#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Get the full file paths of the XRPD data</span></span>
<span id="cb138-5"><a href="machine-learning.html#cb138-5" aria-hidden="true" tabindex="-1"></a>xrpd_paths <span class="ot">&lt;-</span>  <span class="fu">dir</span>(<span class="st">&quot;path/to/xrd&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb138-6"><a href="machine-learning.html#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="machine-learning.html#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the XRPD data</span></span>
<span id="cb138-8"><a href="machine-learning.html#cb138-8" aria-hidden="true" tabindex="-1"></a>xrpd <span class="ot">&lt;-</span> <span class="fu">read_xy</span>(<span class="at">files =</span> xrpd_paths)</span>
<span id="cb138-9"><a href="machine-learning.html#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="machine-learning.html#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Make sure the data are interpolated onto the same 2theta scale</span></span>
<span id="cb138-11"><a href="machine-learning.html#cb138-11" aria-hidden="true" tabindex="-1"></a><span class="co">#as there are small differences within the dataset</span></span>
<span id="cb138-12"><a href="machine-learning.html#cb138-12" aria-hidden="true" tabindex="-1"></a>xrpd <span class="ot">&lt;-</span> <span class="fu">interpolate</span>(xrpd, <span class="at">new_tth =</span> xrpd<span class="sc">$</span>icr030336<span class="sc">$</span>tth)</span></code></pre></div>
</div>
<div id="cubist-exploration" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Data exploration<a href="machine-learning.html#cubist-exploration" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The dataset used in this chapter is comprised of 935 sub-soil samples from sub-Saharan Africa, sampled as part of the AfSIS Sentinel Site programme using the <a href="http://landscapeportal.org/blog/2015/03/25/the-land-degradation-surveillance-framework-ldsf/">Land Degradation Surveillance Framework</a>. A range of soil attributes and properties are provided in the <code>props</code> data, whilst each item within the <code>xrpd</code> data is an XY diffractogram of the soil. The names of <code>xrpd</code> data match the unique identifiers in the <code>props$SSN</code> column:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="machine-learning.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check that the names of the xrpd data match the SSN column in props</span></span>
<span id="cb139-2"><a href="machine-learning.html#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">names</span>(xrpd), props<span class="sc">$</span>SSN)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div id="spatial-data" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Spatial data<a href="machine-learning.html#spatial-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first 4 columns of the <code>props</code> data include the unique <code>SSN</code> identifier of each sample, the name of the Sentinel Site, and the sample location (Longitude and Latitude). Initial exploration of the spatial distribution of the dataset can be achieved using the <strong>leaflet</strong> package <span class="citation">(<a href="#ref-R-leaflet" role="doc-biblioref">Cheng, Karambelkar, and Xie 2022</a>)</span>. A detailed guide of how to use <strong>leaflet</strong> in R is beyond the scope of this documentation, but the code used below can be adapted to produce basic plots of geo-referenced point data. <strong>leaflet</strong> maps are built up in layers similar to the principle of <a href="intro.html#ggplot2-intro"><strong>ggplot2</strong> figures</a>, with each layer being separated by a <code>%&gt;%</code>, which can be written in R using the Ctrl+Shift+M shortcut.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="machine-learning.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(props) <span class="sc">%&gt;%</span> <span class="co">#create a leaflet object from props</span></span>
<span id="cb141-2"><a href="machine-learning.html#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span> <span class="co">#add the default tiles for the map surface</span></span>
<span id="cb141-3"><a href="machine-learning.html#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(<span class="sc">~</span>Longitude, <span class="sc">~</span>Latitude)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-79"></span>
<div id="htmlwidget-7952c17a883bf56e892e" style="width:100%;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-7952c17a883bf56e892e">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[-6.93070316,-6.90836716,-6.88353014,-6.86680222,-6.93858,-6.91083193,-6.88956308,-6.86175203,-6.93122,-6.90524,-6.88657,-6.86209822,-6.92808008,-6.90498781,-6.88443995,-6.87134,-6.12600994,-6.08874989,-6.06394,-6.04692984,-6.11749,-6.08820009,-6.06997013,-6.05574989,-6.12151,-6.09622,-6.0698,-6.05854988,-6.12214,-6.09060001,-6.07987,-6.05373,-5.38104677,-5.35250807,-5.33404493,-5.31900215,-5.38245487,-5.35331202,-5.33592987,-5.30757999,-5.3817668,-5.36247683,-5.33933687,-5.31183291,-5.37793303,-5.35679007,-5.33370018,-5.30851889,-11.12269974,-11.09962845,-11.07450008,-11.05970001,-11.12320042,-11.10610008,-11.07940006,-11.05710316,-11.11730003,-11.10509968,-11.07940006,-11.05809975,-11.12909985,-11.09879971,-11.08710003,-11.0614996,14.77008,14.80026667,14.82152167,14.83678,14.76583,14.80017167,14.82445833,14.83877,14.77771167,14.80662167,14.82578833,14.83955333,14.77818833,14.79109833,14.82136667,14.84399167,12.45030667,12.47221667,12.49274333,12.51337,12.45235333,12.46614167,12.49110333,12.51964667,12.45190833,12.47088667,12.49784667,12.51425667,12.44838333,12.47028667,12.49387,12.51692167,10.88517333,10.90327833,10.92339333,10.94759,10.87761667,10.90319167,10.92799833,10.94325667,10.88015667,10.90277,10.924675,10.94154333,10.87681333,10.89882833,10.92729667,10.950885,-3.06374502,-3.0296979,-3.00909805,-2.99281502,-3.06098199,-3.03815293,-3.00733495,-2.98746705,-3.05848002,-3.03098702,-3.01006794,-2.98789811,-3.06005502,-3.03619504,-3.0151,-2.99145794,-11.65983,-11.64441667,-11.61566833,-11.59462833,-11.65235833,-11.636035,-11.61275667,-11.59183667,-11.65377833,-11.64765,-11.61035833,-11.58774167,-11.66673333,-11.63818833,-11.61,-11.59017167,-15.975425,-15.94640333,-15.92747167,-15.91097,-15.97529,-15.95316167,-15.97414833,-15.947415,-15.92851667,-15.905015,10.86386167,10.88871,10.90801333,10.93269333,10.86856833,10.87777,10.9093,10.92868833,10.86049667,10.88649333,10.91673167,10.92958167,10.86627833,10.88011667,10.90988167,10.92147667,6.69583167,6.71096333,6.73277333,6.75996167,6.68448,6.71250667,6.728055,6.75536333,6.68232667,6.71195333,6.74021833,6.75881833,6.69200167,6.71126667,6.73047667,6.75628667,5.37398667,5.39579,5.41379333,5.44978,5.371555,5.39815167,5.42006,5.44254833,5.377035,5.39910833,5.41552833,5.434675,5.36981833,5.39372667,5.42318167,5.44766667,-8.07403278,-8.04190826,-8.02105045,-8.00080681,-8.07408333,-8.04761505,-8.02381229,-8.00173283,-8.06768513,-8.0423584,-8.02555275,-8.00514507,-8.07075501,-8.04930496,-8.02354813,-8.00446224,-13.44472167,-13.42477667,-13.39751667,-13.37361833,-13.414135,-13.40028833,-13.37299833,-13.43872667,-13.41760667,-13.399045,-13.37075167,-13.44441167,-13.41841667,-13.40278,-13.37711,-14.75066833,-14.726465,-14.70832833,-14.68884167,-14.75414,-14.72360167,-14.70096833,-14.68552,-14.7512,-14.72912667,-14.701545,-14.68108833,-14.74916833,-14.72569333,-14.70472833,-14.68274,-6.92843294,-6.89794493,-6.88135815,-6.86510992,-6.92998695,-6.91006517,-6.87918282,-6.859828,-6.927495,-6.90416813,-6.87863302,-6.85391283,-6.91894484,-6.89881992,-6.87730789,-6.8516202,8.57689476,8.60079002,8.6298523,8.65487957,8.58185482,8.59928799,8.62714481,8.64413834,8.57880211,8.60359764,8.61843967,8.64140797,8.57747841,8.6030798,8.62918758,8.64607239,9.57485485,9.59475517,9.61504269,9.63304997,9.56801796,9.59038162,9.63597775,9.56470776,9.59254456,9.6164484,9.63629723,9.56637478,9.5883646,9.61545658,9.63665199,-0.150345,-0.12604301,-0.12994801,-0.102418,-0.15257999,-0.129155,-0.104105,-0.14825299,-0.13617,-0.106482,-0.15493301,-0.137943,-0.109038,-0.104208,-0.091448,4.14386177,4.17808723,4.19490194,4.21533012,4.14940786,4.17650223,4.19285202,4.2169199,4.14850712,4.1779871,4.1927681,4.20917797,4.14266682,4.16091299,4.19322205,4.20751286,8.10135,8.13086,8.14880667,8.17299167,8.10690833,8.12667833,8.146075,8.173905,8.10638833,8.12839333,8.15104,8.16784833,8.10137667,8.132995,8.15869333,8.17348833,6.97864333,7.00485667,7.02070167,7.04608833,6.97599333,7.00404333,7.02818167,7.04311,6.97757667,7.0012,7.03131,7.05069667,6.98352667,7.00900167,7.02543,7.04615167,6.717035,6.74027833,6.768445,6.78424333,6.71556,6.74281667,6.76571833,6.78485167,6.72280333,6.74489167,6.76660833,6.79339,6.71981167,6.74387833,6.76124,6.780285,11.27548333,11.30450833,11.32941667,11.34459667,11.27253667,11.30263,11.32956833,11.34812,11.28301667,11.30168667,11.31536667,11.351895,11.27255333,11.294715,11.32902667,11.34972,5.232845,5.26178333,5.28236667,5.30309333,5.238615,5.253965,5.27953833,5.30427333,5.23253833,5.25545667,5.28252333,5.29722333,5.233795,5.25533,5.28465667,5.30045833,11.26593208,11.28125763,11.30827332,11.32647038,11.25986958,11.2826004,11.33642006,11.26762962,11.28393459,11.2998848,11.33621693,11.2650528,11.28757477,11.30782032,11.32898712,-2.66469789,-2.64596796,-2.62334704,-2.60788202,-2.66981196,-2.64416289,-2.622082,-2.5984931,-2.67196488,-2.64218307,-2.61965704,-2.60102701,-2.66731191,-2.64556789,-2.62039208,-2.60346293,-1.75930798,-1.73033202,-1.70595801,-1.68905199,-1.74951005,-1.73061001,-1.70412803,-1.68290997,-1.74763703,-1.73084498,-1.70667195,-1.68407798,-1.75810206,-1.73154998,-1.70844495,-1.68765497,10.47201667,10.49729833,10.51886667,10.53704833,10.477555,10.50197833,10.524305,10.53327167,10.47709,10.491285,10.52136833,10.54048833,10.47198167,10.49347167,11.90132833,11.91600667,11.94272667,11.96982,11.90748167,11.92195167,11.94213,11.96197,11.90510833,11.928245,11.94712667,11.96782167,11.89474,11.950435,11.96395833,-27.6111,-27.5922,-27.5684,-27.5477,-27.6131,-27.5868,-27.5634,-27.535,-27.602,-27.5896,-27.5668,-27.5431,-27.6154,-27.5834,-27.5677,-27.545,-29.835,-29.8085,-29.7978,-29.7684,-29.8323,-29.8205,-29.7962,-29.7781,-29.8424,-29.815,-29.7874,-29.7687,-29.8379,-29.816,-29.7993,-29.7734,-29.9721,-29.9494,-29.9487,-29.9058,-29.9716,-29.9505,-29.9345,-29.001227,-29.9813,-29.934,-29.9347,-29.91,-29.9771,-29.9329,-29.9066,-22.86955833,-22.85042333,-22.83018333,-22.80203,-22.87288167,-22.84669833,-22.81783333,-22.80476167,-22.87014333,-22.849915,-22.830515,-22.80366,-22.87506833,-22.84876167,-22.82643,-22.80021333,-18.04285667,-18.02627,-17.998985,-17.98425333,-18.04411167,-18.02787167,-18.00351833,-17.98034833,-18.0472,-18.02587333,-18.00459167,-17.98061,-18.048055,-18.02614167,-17.99677167,-17.977923,-24.24041833,-24.22272333,-24.19612167,-24.16954833,-24.243575,-24.21181833,-24.18840333,-24.17373167,-24.24289667,-24.21673333,-24.19569833,-24.16965333,-24.24200667,-24.21577667,-24.190955,-24.175445,-16.17747833,-16.16296,-16.1334,-16.10983333,-16.17429833,-16.15708333,-16.12728667,-16.11558,-16.178185,-16.15556667,-16.13721833,-16.11628667,-16.17446833,-16.14783,-16.13769833,-16.1104,0.49136299,0.51586801,0.53347302,0.55131698,0.49764001,0.51271302,0.53307802,0.49551699,0.51432502,0.53860003,0.55428702,0.49447301,0.51074201,0.52495998,0.56465697,1.45866,1.473473333,1.527395,1.459293333,1.475106667,1.502983333,1.524523333,1.462205,1.480643333,1.501578333,1.526595,1.456968333,1.473533333,1.501598333,1.524801667,-9.2127,-9.17906,-9.15515,-9.14338,-9.18733,-9.1579,-9.13688,-9.20366,-9.18553,-9.1576,-9.13654,-9.20711,-9.18747,-9.14041,-13.12839833,-13.09985,-13.08315833,-13.062885,-13.12469,-13.10106667,-13.08003,-13.065403,-13.12265333,-13.11281167,-13.07921,-13.06236333,-13.127745,-13.10194667,-13.08635167,-13.06836667,-16.113185,-16.09294,-16.06627833,-16.04487667,-16.11281,-16.09358333,-16.06947333,-16.04143333,-16.11395,-16.09050667,-16.06884,-16.05019667,-16.10458833,-16.088815,-16.066365,-16.04378333,-18.3471,-18.3172,-18.2959,-18.2759,-18.3362,-18.2919,-18.2724,-18.349,-18.3162,-18.2968,-18.2763,-18.3387,-18.3094,-18.2982,-18.2793,13.367585,13.393575,13.418405,13.43555333,13.37571833,13.39504,13.41339833,13.44397,13.371465,13.38991667,13.41907833,13.43786,13.37199833,13.38568167,13.404805,13.43122,11.28078,11.307105,11.33028667,11.35407333,11.29146167,11.31266,11.33524167,11.35515,11.28065833,11.30869,11.332955,11.35259,11.28576667,11.30931667,11.32778667,11.34667,14.809575,14.83139,14.85631333,14.87954,14.80671333,14.83103333,14.858365,14.869855,14.80238833,14.83648167,14.85474833,14.87538667,14.80921167,14.83130167,14.853915,14.87451333,9.166063333,9.191568333,9.221401667,9.233073333,9.166866667,9.192731667,9.241345,9.17576,9.192781667,9.21169,9.237658333,9.170196667,9.188533333,9.217246667,-7.37775,-7.351243333,-7.331673333,-7.315181667,-7.373935,-7.356638333,-7.340811667,-7.31065,-7.372465,-7.361311667,-7.337718333,-7.315528333,-7.372681667,-7.359855,-7.333075,-7.31389,-16.26941333,-16.24470833,-16.21611333,-16.196175,-16.26719667,-16.24029,-16.225095,-16.19894167,-16.26354667,-16.24473333,-16.21921167,-16.203565,-16.268775,-16.24256167,-16.221305,-16.20006,-11.772835,-11.75044833,-11.72324667,-11.70413667,-11.77340167,-11.75164667,-11.72861167,-11.70184,-11.74299833,-11.72815,-11.70322333,-11.77607833,-11.75424667,-11.72477,-11.70006667,-12.35919,-12.33987333,-12.31628333,-12.30484,-12.3554,-12.34284,-12.31856,-12.297935,-12.349295,-12.345895,-12.31855667,-12.295335,-12.357305,-12.32752333,-12.31476833,-12.29723833,-19.425122,-19.41344,-19.38535333,-19.372857,-19.43525,-19.4141,-19.38859667,-19.42756167,-19.39583167,-19.36441167,-19.437477,-19.410165,-19.392763,-19.373928,-18.142,-18.1109,-18.0948,-18.066,-18.137,-18.1169,-18.0858,-18.0663,-18.1381,-18.1141,-18.0962,-18.0749,-18.1315,-18.111,-18.0911,-18.0683,-21.7905,-21.7779,-21.7522,-21.7213,-21.7919,-21.7771,-21.7559,-21.7275,-21.7992,-21.7756,-21.749,-21.7232,-21.7908,-21.7707,-21.7483,-21.731,-19.4157,-19.3975,-19.3805,-19.3495,-19.4158,-19.3952,-19.3695,-19.341,-19.4123,-19.3947,-19.3763,-19.3513,-19.4209,-19.3945,-19.3686,-19.3415,-23.07418667,-23.059075,-23.0258,-23.00548833,-23.07647167,-23.05778833,-23.029855,-23.011145,-23.07066833,-23.05848,-23.032325,-23.00629167,-23.07762,-23.05937667,-23.03121333,-23.00416667,-17.8653,-17.8307,-17.8199,-17.7845,-17.852,-17.8328,-17.8176,-17.7908,-17.8564,-17.8301,-17.8183,-17.7929,-17.8659,-17.8355,-17.8097,-17.7865,-15.897394,-15.867407,-15.85138333,-15.827109,-15.896971,-15.87001333,-15.857948,-15.830405,-15.896332,-15.87658167,-15.84979333,-15.83095833,-15.89698167,-15.871185,-15.819795,-19.021194,-19.006766,-18.973476,-18.953178,-19.024152,-19.005444,-18.977533,-18.958817,-19.018352,-19.002544,-18.980003,-18.953984,-19.025504,-19.007042,-18.978952,-18.951871],[36.09182358,36.08665466,36.0907402,36.09944916,36.1244,36.11650848,36.12222672,36.11831284,36.1357,36.1372,36.1374,36.14105606,36.16547012,36.16339493,36.16698837,36.1579,36.44020081,36.43598175,36.4405,36.4438591,36.4577,36.46326065,36.46458817,36.45772171,36.4836,36.4863,36.4918,36.49095154,36.5064,36.50844955,36.5067,36.5135,37.44506836,37.44896698,37.45391846,37.45064163,37.46924591,37.46604919,37.46857452,37.47093964,37.49669647,37.49689102,37.49335098,37.49250793,37.51511383,37.50985718,37.51532745,37.51255035,35.12689972,35.13019943,35.12540054,35.12659836,35.14569855,35.14979935,35.15179825,35.15173721,35.17409897,35.17229843,35.16930008,35.16949844,35.20069885,35.19520187,35.19179916,35.19319916,-11.03315333,-11.03579167,-11.03285833,-11.03356833,-11.011,-11.01175833,-11.00853333,-11.01125167,-10.98879,-10.98228,-10.99383,-10.99074667,-10.964785,-10.95833333,-10.96745667,-10.96401,-6.327395,-6.326855,-6.33263,-6.32173,-6.309545,-6.312131667,-6.314946667,-6.302163333,-6.288508333,-6.281816667,-6.286193333,-6.280505,-6.263188333,-6.265613333,-6.255561667,-6.259611667,-3.581576667,-3.576025,-3.57667,-3.585211667,-3.558683333,-3.555051667,-3.564085,-3.550565,-3.540295,-3.530618333,-3.533448333,-3.539666667,-3.50814,-3.513665,-3.511266667,-3.513765,33.01008606,33.01520157,33.01538086,33.01611328,33.03066254,33.04239655,33.04496384,33.03326416,33.06501389,33.06267166,33.06552124,33.06058121,33.08431244,33.09140778,33.08854294,33.07735062,34.21137167,34.208565,34.20503833,34.20611667,34.228905,34.225515,34.22261833,34.230455,34.24810833,34.24794167,34.25054833,34.25251,34.27007167,34.281435,34.27014,34.27192667,35.28968167,35.29900667,35.297925,35.30012,35.31520167,35.32146333,35.34251833,35.36159833,35.36705333,35.36222,-2.686115,-2.684621667,-2.681893333,-2.682308333,-2.663826667,-2.661688333,-2.65447,-2.664413333,-2.632743333,-2.640236667,-2.6396,-2.637041667,-2.607243333,-2.620426667,-2.62005,-2.616638333,-1.306978333,-1.309231667,-1.305245,-1.309595,-1.28564,-1.292856667,-1.284068333,-1.295706667,-1.25978,-1.260205,-1.266893333,-1.269926667,-1.241593333,-1.249091667,-1.24715,-1.243568333,-0.787106667,-0.780361667,-0.780368333,-0.771613333,-0.762728333,-0.751176667,-0.75521,-0.764775,-0.726425,-0.733821667,-0.736546667,-0.728883333,-0.714001667,-0.707133333,-0.709083333,-0.717421667,37.26938248,37.27168274,37.27035141,37.27236938,37.29367447,37.295681,37.29229736,37.29563904,37.31658554,37.31354523,37.31706238,37.31461716,37.33062744,37.33369827,37.33749771,37.32851028,35.46230333,35.46136,35.463245,35.45979833,35.48740333,35.48778167,35.47741667,35.509765,35.511175,35.50034833,35.50440167,35.52735167,35.52110333,35.52307667,35.52999333,39.839635,39.84090667,39.83611667,39.84353333,39.85758167,39.86317833,39.86144167,39.86471833,39.8859,39.87938333,39.88362667,39.88605833,39.90905167,39.90788167,39.91341833,39.90612,34.1724205,34.17971039,34.17768097,34.18169403,34.19476318,34.19247818,34.19307327,34.19452667,34.22314835,34.21570587,34.2233963,34.21279907,34.23665237,34.24073792,34.24555969,34.24331284,34.97977448,34.98501205,34.98375702,34.98785019,34.99887466,35.00059891,35.00778198,34.9988327,35.02257156,35.02456665,35.02986145,35.02413177,35.04580688,35.04847336,35.05138397,35.05302811,42.66679382,42.66899109,42.66503906,42.66046143,42.69237518,42.68822861,42.69142151,42.71464157,42.7080574,42.70803833,42.71965027,42.73178101,42.72484207,42.73780441,42.73842239,38.99033356,38.9902153,38.99116898,38.9889183,39.01852417,39.01071167,39.01512146,39.0405426,39.0349884,39.03767776,39.06001282,39.0579567,39.05654144,39.05907822,39.06403351,38.25843048,38.26189041,38.25834656,38.26117706,38.29164124,38.28850937,38.2822876,38.28134918,38.31196213,38.30709839,38.30604172,38.31288528,38.33316422,38.33256149,38.3321991,38.32760239,9.867401667,9.857668333,9.866153333,9.854511667,9.881415,9.880528333,9.884018333,9.888138333,9.903975,9.910415,9.90334,9.90665,9.921948333,9.929275,9.93064,9.927748333,9.305081667,9.30729,9.30712,9.304748333,9.33337,9.332265,9.335976667,9.33436,9.348373333,9.357101667,9.35504,9.354231667,9.376038333,9.378645,9.366843333,9.370495,4.630036667,4.629376667,4.625046667,4.627915,4.650443333,4.643856667,4.644376667,4.643185,4.667463333,4.666406667,4.672126667,4.666761667,4.688821667,4.68995,4.692641667,4.696635,-5.5312,-5.532908333,-5.534058333,-5.52968,-5.513963333,-5.513288333,-5.518538333,-5.520495,-5.486493333,-5.48807,-5.496258333,-5.48847,-5.464043333,-5.470245,-5.466885,-5.469775,10.226835,10.22336667,10.22913667,10.22817,10.258085,10.25103167,10.242555,10.249175,10.27185333,10.26777667,10.27224833,10.26682167,10.28871167,10.28552,10.28513333,10.293825,39.57683945,39.5773468,39.57263565,39.57241058,39.59523392,39.59399414,39.59075165,39.61626434,39.61522293,39.61911392,39.61544418,39.6417923,39.63938141,39.64009476,39.64373779,39.514431,39.51325607,39.51435852,39.5163269,39.53773499,39.5366745,39.53253555,39.53760147,39.55476761,39.55010605,39.55268478,39.56488037,39.57624435,39.57897949,39.57739258,39.5819931,35.77468491,35.77527618,35.78072357,35.77809525,35.79748917,35.80042267,35.80501556,35.80660629,35.82118225,35.81271362,35.82385635,35.8180542,35.84511185,35.84485626,35.84159088,35.8539772,-13.424075,-13.42232167,-13.43299667,-13.42797333,-13.40055167,-13.40440167,-13.40126833,-13.410885,-13.37363833,-13.380635,-13.38026167,-13.38327833,-13.36306333,-13.36102833,-13.17387667,-13.17532833,-13.17404833,-13.17629333,-13.15499,-13.15272167,-13.157495,-13.153175,-13.13042,-13.13387,-13.13483167,-13.12979333,-13.107555,-13.11220667,-13.10541333,30.0127,30.0235,30.0228,30.0232,30.045,30.0455,30.0408,30.0388,30.06,30.0597,30.0585,30.071,30.0861,30.0894,30.0907,30.0929,23.9142,23.9044,23.9075,23.9145,23.9373,23.9277,23.9288,23.933,23.9545,23.9544,23.9515,23.9539,23.9832,23.9757,23.9782,23.983,22.7102,22.7059,22.7115,22.7159,22.7325,22.7371,22.7283,22.736919,22.7623,22.7603,22.7598,22.7619,22.7788,22.7803,22.7832,35.26938,35.273025,35.27128833,35.26829167,35.29462,35.28799167,35.28526167,35.28788167,35.313225,35.31727333,35.31782,35.31284167,35.33858167,35.33593,35.336955,35.33732,36.79774333,36.79851167,36.80058,36.79508667,36.82392333,36.81948333,36.81749667,36.82528667,36.84010167,36.846685,36.84410833,36.84061,36.86693667,36.86523833,36.86077167,36.861702,34.33520333,34.33146167,34.33393167,34.32811,34.35064167,34.34482833,34.34585833,34.35931333,34.37187333,34.37512,34.37663333,34.38194667,34.39977333,34.398345,34.40507,34.399385,38.93670333,38.94107833,38.94113333,38.93812333,38.96290833,38.95627333,38.95530167,38.96545167,38.99062167,38.98825167,38.9843,38.98612833,39.00523333,39.003835,39.00373,39.01113833,32.27067566,32.26354218,32.26804352,32.26622772,32.28783798,32.28875732,32.2866745,32.30453873,32.30515671,32.31171417,32.31141281,32.33593369,32.33942032,32.33211136,32.33332062,31.46679667,31.46200667,31.46912333,31.48978667,31.48906833,31.490945,31.48840667,31.507475,31.513555,31.51283333,31.51443,31.53370833,31.52892,31.53512667,31.53509333,29.6294,29.6372,29.6233,29.6314,29.6553,29.6499,29.6462,29.6761,29.6753,29.6706,29.6744,29.6942,29.7011,29.689,28.437565,28.43995333,28.44561,28.44091,28.47377833,28.458735,28.47069333,28.473107,28.49141167,28.485475,28.49115833,28.48207,28.51711333,28.50299833,28.509135,28.51594667,28.26820667,28.26640167,28.260995,28.25742667,28.27992667,28.28641167,28.28348833,28.28783833,28.30799833,28.30285,28.30719667,28.30818,28.324225,28.32333333,28.32649833,28.32967,48.6935,48.6883,48.692,48.6875,48.71,48.7134,48.7098,48.7392,48.7348,48.7352,48.7363,48.7558,48.7565,48.7534,48.7545,1.735376667,1.735128333,1.731593333,1.738738333,1.759763333,1.75692,1.754711667,1.754626667,1.779663333,1.77919,1.786608333,1.777961667,1.804516667,1.798298333,1.802671667,1.799123333,8.123596667,8.119573333,8.124355,8.121323333,8.145926667,8.148253333,8.150375,8.146985,8.166768333,8.175328333,8.173293333,8.169905,8.197546667,8.19152,8.192435,8.194856667,-7.843511667,-7.843868333,-7.846765,-7.8447,-7.825015,-7.823068333,-7.82084,-7.819491667,-7.802876667,-7.809873333,-7.80709,-7.795621667,-7.78246,-7.780153333,-7.781675,-7.780065,5.678096667,5.671851667,5.666751667,5.676535,5.69213,5.697721667,5.689193333,5.711345,5.719468333,5.715875,5.717488333,5.738131667,5.742303333,5.73423,15.68749167,15.68781667,15.687965,15.69147833,15.719655,15.71737333,15.71909667,15.71785667,15.73818833,15.73790167,15.73058833,15.74003333,15.76295333,15.76168,15.76078667,15.76066667,14.883505,14.88468667,14.88083,14.87335667,14.89980667,14.90458833,14.89889,14.89918167,14.930115,14.92850333,14.93248,14.92257333,14.958435,14.94835667,14.94596167,14.95128667,15.87541167,15.87774167,15.88526667,15.88675,15.90902167,15.904305,15.90537,15.905035,15.925165,15.92955167,15.92522667,15.95362833,15.95240333,15.94343,15.9523,15.14388333,15.14360333,15.15200333,15.14741667,15.16175667,15.17547833,15.17408167,15.17505,15.20264667,15.19027833,15.2063,15.19546833,15.21692167,15.22182667,15.21382333,15.22342333,28.724613,28.733862,28.72538333,28.721183,28.754072,28.74545833,28.74953333,28.76724667,28.76500833,28.77160167,28.792972,28.794548,28.802128,28.786663,29.4097,29.4157,29.4155,29.4092,29.4347,29.4375,29.4351,29.4295,29.4551,29.4552,29.4588,29.4566,29.4801,29.485,29.4842,29.4841,26.458,26.4554,26.4592,26.457,26.4815,26.4829,26.4813,26.4797,26.5087,26.5008,26.5039,26.4957,26.5175,26.526,26.5266,26.5229,22.0154,22.0256,22.0165,22.0128,22.0395,22.039,22.0389,22.0368,22.06,22.0671,22.062,22.0571,22.0793,22.0855,22.0829,22.0791,23.07418667,23.059075,23.0258,23.00548833,23.07647167,23.05778833,23.029855,23.011145,23.07066833,23.05848,23.032325,23.00629167,23.07762,23.05937667,23.03121333,23.00416667,31.8363,31.8367,31.8338,31.8373,31.8612,31.8576,31.8616,31.8557,31.8759,31.8726,31.8831,31.8807,31.8962,31.9065,31.9012,31.9016,26.093142,26.098539,26.095875,26.095398,26.115347,26.118435,26.111965,26.121272,26.142028,26.13388333,26.140195,26.13990833,26.166365,26.163502,26.16895,46.636952,46.629129,46.63606,46.6373,46.659441,46.657214,46.659112,46.658112,46.675688,46.677495,46.681078,46.68258,46.706172,46.697128,46.703312,46.706503],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[-29.9813,14.87954],"lng":[-13.43299667,48.7565]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.1: Interactive map of the Sentinel Site data showing all 60 sites across sub-Saharan Africa.
</p>
</div>
<p>The map resulting from the above code shows the 60 Sentinel Sites within the dataset that together account for many of the agro-ecological regions of sub-Saharan Africa. By zooming in on the Sentinel Sites individually, it can be observed that each is comprised of a random grid of up to 16 samples within a 10 x 10 km area <span class="citation">(<a href="#ref-Butler2020" role="doc-biblioref">Butler et al. 2020</a>)</span>:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="machine-learning.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(props[props<span class="sc">$</span>Sentinel_site <span class="sc">==</span> <span class="st">&quot;Bana&quot;</span>,]) <span class="sc">%&gt;%</span></span>
<span id="cb142-2"><a href="machine-learning.html#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb142-3"><a href="machine-learning.html#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(<span class="sc">~</span>Longitude, <span class="sc">~</span>Latitude)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-80"></span>
<div id="htmlwidget-8134291656c7da02a440" style="width:100%;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-8134291656c7da02a440">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[5.232845,5.26178333,5.28236667,5.30309333,5.238615,5.253965,5.27953833,5.30427333,5.23253833,5.25545667,5.28252333,5.29722333,5.233795,5.25533,5.28465667,5.30045833],[10.226835,10.22336667,10.22913667,10.22817,10.258085,10.25103167,10.242555,10.249175,10.27185333,10.26777667,10.27224833,10.26682167,10.28871167,10.28552,10.28513333,10.293825],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[5.23253833,5.30427333],"lng":[10.22336667,10.293825]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.2: Interactive map of the Bana Sentinel Site showing the sixteen sampling locations within the 10 x 10 km grid.
</p>
</div>
</div>
<div id="geochemical-data" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Geochemical data<a href="machine-learning.html#geochemical-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>props</code> data contains a wide range of geochemical variables including pH, total organic carbon (TOC), total element concentrations (columns 9 to 15) and Mehlich-3 extractable element concentrations (columns 16 to 23). The examples provided in this chapter will focus on total concentrations of K, determined using X-ray Fluorescence <span class="citation">(<a href="#ref-Butler2020" role="doc-biblioref">Butler et al. 2020</a>)</span>, but the code can be easily adjusted for any other soil property within the dataset.</p>
<p>Here the K concentration data will be summarised using the <code>summary()</code> function plotted as a histogram using <strong>ggplot2</strong>:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="machine-learning.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summarise the K concentration data</span></span>
<span id="cb143-2"><a href="machine-learning.html#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(props<span class="sc">$</span>K)</span></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
##    90.41  2482.09  7045.57 11535.65 16947.73 95674.79</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="machine-learning.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Produce a histrogram of the log transformed K data</span></span>
<span id="cb145-2"><a href="machine-learning.html#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> props, <span class="fu">aes</span>(<span class="fu">log</span>(K))) <span class="sc">+</span></span>
<span id="cb145-3"><a href="machine-learning.html#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-81"></span>
<img src="DigiMinR_files/figure-html/unnamed-chunk-81-1.png" alt="Histogram of total K concentrations (log transformed)" width="100%" />
<p class="caption">
Figure 3.3: Histogram of total K concentrations (log transformed)
</p>
</div>
</div>
<div id="xrpd-data" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> XRPD data<a href="machine-learning.html#xrpd-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Given there are 935 diffractograms within the <code>xrpd</code> data, it is not possible to visually inspect all data at once. To start with, it is probably worth visualising the diffractograms from one Sentinel site at a time.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="machine-learning.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as_multi_xy</span>(xrpd[props<span class="sc">$</span>SSN[props<span class="sc">$</span>Sentinel_site <span class="sc">==</span> <span class="st">&quot;Didy&quot;</span>]]),</span>
<span id="cb146-2"><a href="machine-learning.html#cb146-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">wavelength =</span> <span class="st">&quot;Cu&quot;</span>,</span>
<span id="cb146-3"><a href="machine-learning.html#cb146-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">normalise =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:didy-all-fig"></span>
<img src="DigiMinR_files/figure-html/didy-all-fig-1.png" alt="Diffractograms associated with the Didy site." width="100%" />
<p class="caption">
Figure 3.4: Diffractograms associated with the Didy site.
</p>
</div>
<p>Visualising the data in this way shows how the strongest peak in each diffractogram at the ‘Didy’ Sentinel Site occurs at approximately 26 <span class="math inline">\(^\circ\)</span> 2θ. Further inspection of this peak shows how there are minor adjustments in alignment that will need to be applied to the data:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="machine-learning.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as_multi_xy</span>(xrpd[props<span class="sc">$</span>Sentinel_site <span class="sc">==</span> <span class="st">&quot;Didy&quot;</span>]),</span>
<span id="cb147-2"><a href="machine-learning.html#cb147-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">wavelength =</span> <span class="st">&quot;Cu&quot;</span>,</span>
<span id="cb147-3"><a href="machine-learning.html#cb147-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">normalise =</span> <span class="cn">TRUE</span>,</span>
<span id="cb147-4"><a href="machine-learning.html#cb147-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">26</span>,<span class="dv">27</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-82"></span>
<img src="DigiMinR_files/figure-html/unnamed-chunk-82-1.png" alt="The major quartz peak of the diffractograms associated with the Didy site, highlighting small 2theta misalignments." width="100%" />
<p class="caption">
Figure 3.5: The major quartz peak of the diffractograms associated with the Didy site, highlighting small 2theta misalignments.
</p>
</div>
<p>This strong peak is associated with quartz, which is omnipresent in soil datasets like this and is a strong diffractor of X-rays. Together this results in quartz peaks being the dominant signal in most soil diffractograms, which is a feature that can be particularly useful for <a href="intro.html#alignment">peak alignment</a> when <a href="machine-learning.html#cubist-pretreatment">pre-treating</a> the data.</p>
</div>
</div>
<div id="cubist-pretreatment" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Data pre-treatment<a href="machine-learning.html#cubist-pretreatment" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/__8IWU7Um5s" frameborder="0" allowfullscreen>
</iframe>
</p>
<p>Prior to applying Cubist to the XRPD data, it is important to apply corrections for sample-independent variation such as small 2θ misalignments and/or fluctuations in count intensities.</p>
<div id="alignment-1" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Alignment<a href="machine-learning.html#alignment-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The small 2θ misalignments identified <a href="machine-learning.html#cubist-exploration">above</a> can be corrected for using the <a href="intro.html#alignment"><code>align_xy()</code> function</a> in <strong>powdR</strong>. Quartz is omnipresent within the dataset and therefore the samples can be aligned to a pure quartz pattern. A pure quartz pattern can be created from the <code>rockjock</code> library, and then used for sample alignment within a restricted 2θ range.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="machine-learning.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extract a quartz pattern from rockjock</span></span>
<span id="cb148-2"><a href="machine-learning.html#cb148-2" aria-hidden="true" tabindex="-1"></a>quartz <span class="ot">&lt;-</span> <span class="fu">as_xy</span>(<span class="fu">data.frame</span>(rockjock<span class="sc">$</span>tth,</span>
<span id="cb148-3"><a href="machine-learning.html#cb148-3" aria-hidden="true" tabindex="-1"></a>                           rockjock<span class="sc">$</span>xrd<span class="sc">$</span>QUARTZ))</span>
<span id="cb148-4"><a href="machine-learning.html#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="machine-learning.html#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(quartz, <span class="at">wavelength =</span> <span class="st">&quot;Cu&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-83"></span>
<img src="DigiMinR_files/figure-html/unnamed-chunk-83-1.png" alt="A pure quartz pattern extracted from the rockjock reference library." width="100%" />
<p class="caption">
Figure 3.6: A pure quartz pattern extracted from the rockjock reference library.
</p>
</div>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="machine-learning.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Align the xrpd data to this quartz pattern</span></span>
<span id="cb149-2"><a href="machine-learning.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="co">#using a restricted 2theta range of 10 to 60</span></span>
<span id="cb149-3"><a href="machine-learning.html#cb149-3" aria-hidden="true" tabindex="-1"></a>xrpd_pt <span class="ot">&lt;-</span> <span class="fu">align_xy</span>(xrpd, <span class="at">std =</span> quartz,</span>
<span id="cb149-4"><a href="machine-learning.html#cb149-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="dv">10</span>, <span class="at">xmax =</span> <span class="dv">60</span>,</span>
<span id="cb149-5"><a href="machine-learning.html#cb149-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xshift =</span> <span class="fl">0.2</span>)</span>
<span id="cb149-6"><a href="machine-learning.html#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="machine-learning.html#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as_multi_xy</span>(xrpd_pt[props<span class="sc">$</span>Sentinel_site <span class="sc">==</span> <span class="st">&quot;Didy&quot;</span>]),</span>
<span id="cb149-8"><a href="machine-learning.html#cb149-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">wavelength =</span> <span class="st">&quot;Cu&quot;</span>,</span>
<span id="cb149-9"><a href="machine-learning.html#cb149-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">normalise =</span> <span class="cn">TRUE</span>,</span>
<span id="cb149-10"><a href="machine-learning.html#cb149-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">26</span>,<span class="dv">27</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-84"></span>
<img src="DigiMinR_files/figure-html/unnamed-chunk-84-1.png" alt="Diffractograms from the Didy site aligned to the quartz pattern extracted from the rockjock reference library." width="100%" />
<p class="caption">
Figure 3.7: Diffractograms from the Didy site aligned to the quartz pattern extracted from the rockjock reference library.
</p>
</div>
<p>Alignment of the data in this way is important because even seemingly small misalignments between peaks can hinder the comparison of XRPD data by multivariate methods, and hence reduce the effectiveness of the analysis <span class="citation">(<a href="#ref-Butler2019" role="doc-biblioref">Butler et al. 2019</a>)</span>.</p>
</div>
<div id="subsetting-1" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Subsetting<a href="machine-learning.html#subsetting-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Figure <a href="machine-learning.html#fig:didy-all-fig">3.4</a> it can be observed that below ~4 <span class="math inline">\(^\circ\)</span> 2θ there is a tall tail in count intensities. This tail, probably due to the detector starting to ‘see’ the direct beam form the X-ray source, can be removed by subsetting the data using the code <a href="intro.html#subsetting">described above</a>.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="machine-learning.html#cb150-1" aria-hidden="true" tabindex="-1"></a>xrpd_pt <span class="ot">&lt;-</span> <span class="fu">lapply</span>(xrpd_pt, subset,</span>
<span id="cb150-2"><a href="machine-learning.html#cb150-2" aria-hidden="true" tabindex="-1"></a>                  tth <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> tth <span class="sc">&lt;=</span> <span class="dv">75</span>)</span>
<span id="cb150-3"><a href="machine-learning.html#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="machine-learning.html#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as_multi_xy</span>(xrpd_pt[props<span class="sc">$</span>Sentinel_site <span class="sc">==</span> <span class="st">&quot;Didy&quot;</span>]),</span>
<span id="cb150-5"><a href="machine-learning.html#cb150-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">wavelength =</span> <span class="st">&quot;Cu&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-85"></span>
<img src="DigiMinR_files/figure-html/unnamed-chunk-85-1.png" alt="Aligned diffractograms subset to remove data below 5 degrees 2theta." width="100%" />
<p class="caption">
Figure 3.8: Aligned diffractograms subset to remove data below 5 degrees 2theta.
</p>
</div>
</div>
<div id="mean-centering" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Mean centering<a href="machine-learning.html#mean-centering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In addition to alignment and subsetting, it can be useful to adjust the data for fluctuating count intensities that can be associated with factors such as the natural deterioration of the X-ray source over time. Such adjustment can be achieved by mean centering, which subtracts the mean from the count intensities of each sample:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="machine-learning.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a mean centering function</span></span>
<span id="cb151-2"><a href="machine-learning.html#cb151-2" aria-hidden="true" tabindex="-1"></a>mean_center <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb151-3"><a href="machine-learning.html#cb151-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-4"><a href="machine-learning.html#cb151-4" aria-hidden="true" tabindex="-1"></a>  x[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> x[[<span class="dv">2</span>]] <span class="sc">-</span> <span class="fu">mean</span>(x[[<span class="dv">2</span>]])</span>
<span id="cb151-5"><a href="machine-learning.html#cb151-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-6"><a href="machine-learning.html#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb151-7"><a href="machine-learning.html#cb151-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-8"><a href="machine-learning.html#cb151-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb151-9"><a href="machine-learning.html#cb151-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-10"><a href="machine-learning.html#cb151-10" aria-hidden="true" tabindex="-1"></a><span class="co">#apply the function to all patterns</span></span>
<span id="cb151-11"><a href="machine-learning.html#cb151-11" aria-hidden="true" tabindex="-1"></a>xrpd_pt <span class="ot">&lt;-</span> <span class="fu">lapply</span>(xrpd_pt, mean_center)</span>
<span id="cb151-12"><a href="machine-learning.html#cb151-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-13"><a href="machine-learning.html#cb151-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Inspect the data from Didy</span></span>
<span id="cb151-14"><a href="machine-learning.html#cb151-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as_multi_xy</span>(xrpd_pt[props<span class="sc">$</span>Sentinel_site <span class="sc">==</span> <span class="st">&quot;Didy&quot;</span>]),</span>
<span id="cb151-15"><a href="machine-learning.html#cb151-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">wavelength =</span> <span class="st">&quot;Cu&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-86"></span>
<img src="DigiMinR_files/figure-html/unnamed-chunk-86-1.png" alt="Aligned, subset and mean centred diffractograms." width="100%" />
<p class="caption">
Figure 3.9: Aligned, subset and mean centred diffractograms.
</p>
</div>
<p>Now we are left with the dataset <code>xrpd</code> which consists of 935 diffractograms that have each been aligned, subset and mean centred. At this point we are ready to apply the Cubist algorithm to the data.</p>
</div>
</div>
<div id="creation-of-training-and-test-datasets" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Creation of training and test datasets<a href="machine-learning.html#creation-of-training-and-test-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Cubist is a supervised machine learning algorithm and therefore requires training using a dataset that accounts for much of the variation that may be observed in the dataset that Cubist predicts a given soil property from.</p>
<p>Here, 75 % of the data will be used as a training set for Cubist to develop appropriate decisions and regression models from, hereafter, the training dataset. The remaining 25 % of the data will be used to test the accuracy of the derived models on ‘new’ data (i.e. data that was not used to train the model), hereafter, the test dataset.</p>
<p>There are a range of different approaches for defining the training and test datasets. Here a purely random approach will be employed using the <code>sample()</code> function:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="machine-learning.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Set the seed for random number generation</span></span>
<span id="cb152-2"><a href="machine-learning.html#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="co">#so that results are reproducible.</span></span>
<span id="cb152-3"><a href="machine-learning.html#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb152-4"><a href="machine-learning.html#cb152-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-5"><a href="machine-learning.html#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Randomly select 75% of the samples</span></span>
<span id="cb152-6"><a href="machine-learning.html#cb152-6" aria-hidden="true" tabindex="-1"></a>selection <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(props),</span>
<span id="cb152-7"><a href="machine-learning.html#cb152-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">size =</span> <span class="fu">round</span>(<span class="fu">nrow</span>(props)<span class="sc">*</span><span class="fl">0.75</span>),</span>
<span id="cb152-8"><a href="machine-learning.html#cb152-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">replace =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="using-cubist" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Using Cubist<a href="machine-learning.html#using-cubist" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/Y9TOveVOUxQ" frameborder="0" allowfullscreen>
</iframe>
</p>
<p>Here Cubist will be applied to the XRPD data in order to predict and interpret total K concentrations. Underpinning this approach is the principle that a soil diffractogram represents a reproducible signature of that soil’s mineral composition, and the mineral composition is a key controller of total K concentrations. The code can be readily adapted to any of the other properties within the data, or to your own soil XRPD data and associated properties.</p>
<p>To run Cubist the XRPD data need to be supplied in dataframe format, with each row of the dataframe representing a sample. The XRPD data can easily be converted to a dataframe using the <code>multi_xy_to_df</code> function <a href="intro.html#to-data-frame">outlined above</a>:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="machine-learning.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">#double check that the order of xrpd and props </span></span>
<span id="cb153-2"><a href="machine-learning.html#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="co">#data match</span></span>
<span id="cb153-3"><a href="machine-learning.html#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">names</span>(xrpd_pt), props<span class="sc">$</span>SSN)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="machine-learning.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a data frame</span></span>
<span id="cb155-2"><a href="machine-learning.html#cb155-2" aria-hidden="true" tabindex="-1"></a>xrpd_df <span class="ot">&lt;-</span> <span class="fu">multi_xy_to_df</span>(<span class="fu">as_multi_xy</span>(xrpd_pt),</span>
<span id="cb155-3"><a href="machine-learning.html#cb155-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">tth =</span> <span class="cn">TRUE</span>)</span>
<span id="cb155-4"><a href="machine-learning.html#cb155-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-5"><a href="machine-learning.html#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="co">#transpose the data so that each sample is a row</span></span>
<span id="cb155-6"><a href="machine-learning.html#cb155-6" aria-hidden="true" tabindex="-1"></a>cubist_xrpd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(xrpd_df[<span class="sc">-</span><span class="dv">1</span>]))</span></code></pre></div>
<p>There are a couple of parameters that can be adjusted when training Cubist models: committees and neighbours (see <span class="citation">Butler, O’Rourke, and Hillier (<a href="#ref-Butler2018" role="doc-biblioref">2018</a>)</span>). Various routines exist for tuning these parameters in order to produce the most accurate models. For further reading on this tuning process, see the documentation for the <strong>caret</strong> and <strong>Cubist</strong> packages.</p>
<p>For simplicity, the adjustable Cubist parameters used in this example will be set to <code>committees = 10</code> when training the models, and <code>neighbours = 9</code> when using the derived models to predict total K concentrations from new data. The Cubist models can be trained using the training dataset using:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="machine-learning.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a Cubist model for K</span></span>
<span id="cb156-2"><a href="machine-learning.html#cb156-2" aria-hidden="true" tabindex="-1"></a>cubist_K <span class="ot">&lt;-</span> <span class="fu">cubist</span>(<span class="at">x =</span> cubist_xrpd[selection,],</span>
<span id="cb156-3"><a href="machine-learning.html#cb156-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> props<span class="sc">$</span>K[selection],</span>
<span id="cb156-4"><a href="machine-learning.html#cb156-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">committees =</span> <span class="dv">10</span>)</span></code></pre></div>
<p>following which, the derived models can be used to predict the total K concentrations from XRPD data in the test dataset:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="machine-learning.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Predict K</span></span>
<span id="cb157-2"><a href="machine-learning.html#cb157-2" aria-hidden="true" tabindex="-1"></a>predict_K <span class="ot">&lt;-</span> <span class="fu">predict</span>(cubist_K,</span>
<span id="cb157-3"><a href="machine-learning.html#cb157-3" aria-hidden="true" tabindex="-1"></a>                     cubist_xrpd[<span class="sc">-</span>selection,],</span>
<span id="cb157-4"><a href="machine-learning.html#cb157-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">neighbours =</span> <span class="dv">9</span>)</span>
<span id="cb157-5"><a href="machine-learning.html#cb157-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-6"><a href="machine-learning.html#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot measured K vs predicted K</span></span>
<span id="cb157-7"><a href="machine-learning.html#cb157-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">log</span>(props<span class="sc">$</span>K[<span class="sc">-</span>selection]), <span class="fu">log</span>(predict_K),</span>
<span id="cb157-8"><a href="machine-learning.html#cb157-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;log(Measured K), ppm&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;log(Predicted K), ppm&quot;</span>)</span>
<span id="cb157-9"><a href="machine-learning.html#cb157-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="co">#Add a 1:1 line</span></span></code></pre></div>
<p><img src="DigiMinR_files/figure-html/unnamed-chunk-90-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="machine-learning.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co">#R2 of measured K vs predicted K</span></span>
<span id="cb158-2"><a href="machine-learning.html#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(<span class="fu">log</span>(props<span class="sc">$</span>K[<span class="sc">-</span>selection]), <span class="fu">log</span>(predict_K))<span class="sc">^</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 0.8540419</code></pre>
<p>The Cubist model for K prediction therefore results in a relatively accurate prediction of K, with an <span class="math inline">\(R^2\)</span> of ~0.85. This indicates that Cubist is able to extract appropriate variables from the XRPD data and use them to predict chemical soil properties.</p>
</div>
<div id="inspection-of-cubist-models" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Inspection of Cubist models<a href="machine-learning.html#inspection-of-cubist-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/FR_1y4W6cTk" frameborder="0" allowfullscreen>
</iframe>
</p>
<p>The variables that Cubist selects can be plotted in order to decipher the mineral contributions to a given soil property:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="machine-learning.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extract the usage data from the Cubist model</span></span>
<span id="cb160-2"><a href="machine-learning.html#cb160-2" aria-hidden="true" tabindex="-1"></a>K_usage <span class="ot">&lt;-</span> cubist_K<span class="sc">$</span>usage</span>
<span id="cb160-3"><a href="machine-learning.html#cb160-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-4"><a href="machine-learning.html#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Make sure the variable names are numeric so that they can be ordered</span></span>
<span id="cb160-5"><a href="machine-learning.html#cb160-5" aria-hidden="true" tabindex="-1"></a>K_usage<span class="sc">$</span>Variable <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(K_usage<span class="sc">$</span>Variable,</span>
<span id="cb160-6"><a href="machine-learning.html#cb160-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="dv">2</span>,</span>
<span id="cb160-7"><a href="machine-learning.html#cb160-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">nchar</span>(K_usage<span class="sc">$</span>Variable)))</span>
<span id="cb160-8"><a href="machine-learning.html#cb160-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-9"><a href="machine-learning.html#cb160-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Order the K_usage data by Variable now it is numeric</span></span>
<span id="cb160-10"><a href="machine-learning.html#cb160-10" aria-hidden="true" tabindex="-1"></a>K_usage <span class="ot">&lt;-</span> K_usage[<span class="fu">order</span>(K_usage<span class="sc">$</span>Variable), ]</span>
<span id="cb160-11"><a href="machine-learning.html#cb160-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-12"><a href="machine-learning.html#cb160-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Add the 2theta axis</span></span>
<span id="cb160-13"><a href="machine-learning.html#cb160-13" aria-hidden="true" tabindex="-1"></a>K_usage<span class="sc">$</span>tth <span class="ot">&lt;-</span> xrpd_df<span class="sc">$</span>tth</span>
<span id="cb160-14"><a href="machine-learning.html#cb160-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-15"><a href="machine-learning.html#cb160-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Add a mean diffracotgram to the data</span></span>
<span id="cb160-16"><a href="machine-learning.html#cb160-16" aria-hidden="true" tabindex="-1"></a>K_usage<span class="sc">$</span>counts <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(xrpd_df[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb160-17"><a href="machine-learning.html#cb160-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-18"><a href="machine-learning.html#cb160-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a function that normalises a vector data to a minimum of 0</span></span>
<span id="cb160-19"><a href="machine-learning.html#cb160-19" aria-hidden="true" tabindex="-1"></a><span class="co">#and maximum of 1.</span></span>
<span id="cb160-20"><a href="machine-learning.html#cb160-20" aria-hidden="true" tabindex="-1"></a>range01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){(x<span class="sc">-</span><span class="fu">min</span>(x))<span class="sc">/</span>(<span class="fu">max</span>(x)<span class="sc">-</span><span class="fu">min</span>(x))}</span>
<span id="cb160-21"><a href="machine-learning.html#cb160-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-22"><a href="machine-learning.html#cb160-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the plot</span></span>
<span id="cb160-23"><a href="machine-learning.html#cb160-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> K_usage) <span class="sc">+</span> </span>
<span id="cb160-24"><a href="machine-learning.html#cb160-24" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">x =</span> tth, <span class="at">ymax =</span> Model<span class="sc">/</span><span class="dv">100</span>, <span class="at">ymin =</span> <span class="dv">0</span>),</span>
<span id="cb160-25"><a href="machine-learning.html#cb160-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">&quot;grey81&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb160-26"><a href="machine-learning.html#cb160-26" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">x =</span> tth, <span class="at">ymax =</span> Conditions<span class="sc">/</span><span class="dv">100</span>, <span class="at">ymin =</span> <span class="dv">0</span>),</span>
<span id="cb160-27"><a href="machine-learning.html#cb160-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">&quot;grey19&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb160-28"><a href="machine-learning.html#cb160-28" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> tth, <span class="at">y =</span> <span class="fu">range01</span>(counts)), <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb160-29"><a href="machine-learning.html#cb160-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb160-30"><a href="machine-learning.html#cb160-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Scaled counts and fraction of variable use</span><span class="sc">\n</span><span class="st">&quot;</span>) <span class="sc">+</span></span>
<span id="cb160-31"><a href="machine-learning.html#cb160-31" aria-hidden="true" tabindex="-1"></a><span class="fu">xlab</span>(<span class="st">&quot;2theta&quot;</span>) <span class="sc">+</span></span>
<span id="cb160-32"><a href="machine-learning.html#cb160-32" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:feature-plot"></span>
<img src="DigiMinR_files/figure-html/feature-plot-1.png" alt="Features selected by Cubist for the prediction of K. Grey sticks denote the fraction of variable use in the regression models and black sticks denote the fraction of variable use in decision. Red line is the mean diffractogram for the dataset." width="100%" />
<p class="caption">
Figure 3.10: Features selected by Cubist for the prediction of K. Grey sticks denote the fraction of variable use in the regression models and black sticks denote the fraction of variable use in decision. Red line is the mean diffractogram for the dataset.
</p>
</div>
<p>Figure <a href="machine-learning.html#fig:feature-plot">3.10</a> shows how the most important variables for prediction of K concentrations are found between 25 and 30 <span class="math inline">\(^\circ\)</span> 2θ. To further aid with interpretation of such regions, these plots can be combined with data from <a href="quant.html#quant">full pattern summation</a> so that the variables selected by Cubist can be attributed to specific minerals. For example:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="machine-learning.html#cb161-1" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">fps</span>(<span class="at">lib =</span> rockjock,</span>
<span id="cb161-2"><a href="machine-learning.html#cb161-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">smpl =</span> xrpd<span class="sc">$</span>icr014764,</span>
<span id="cb161-3"><a href="machine-learning.html#cb161-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">std =</span> <span class="st">&quot;QUARTZ&quot;</span>,</span>
<span id="cb161-4"><a href="machine-learning.html#cb161-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">refs =</span> <span class="fu">c</span>(<span class="st">&quot;K-feldspar&quot;</span>,</span>
<span id="cb161-5"><a href="machine-learning.html#cb161-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Quartz&quot;</span>,</span>
<span id="cb161-6"><a href="machine-learning.html#cb161-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Mica (Tri)&quot;</span>,</span>
<span id="cb161-7"><a href="machine-learning.html#cb161-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Organic matter&quot;</span>,</span>
<span id="cb161-8"><a href="machine-learning.html#cb161-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Halloysite&quot;</span>,</span>
<span id="cb161-9"><a href="machine-learning.html#cb161-9" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Kaolinite&quot;</span>,</span>
<span id="cb161-10"><a href="machine-learning.html#cb161-10" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Rutile&quot;</span>,</span>
<span id="cb161-11"><a href="machine-learning.html#cb161-11" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Background&quot;</span>),</span>
<span id="cb161-12"><a href="machine-learning.html#cb161-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">align =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<pre><code>## 
## -Harmonising library to the same 2theta resolution as the sample
## -Aligning sample to the internal standard
## -Interpolating library to same 2theta scale as aligned sample
## -Optimising...
## -Removing negative coefficients and reoptimising...
## -Removing negative coefficients and reoptimising...
## -Removing negative coefficients and reoptimising...
## -Computing phase concentrations
## -Internal standard concentration unknown. Assuming phases sum to 100 %
## ***Full pattern summation complete***</code></pre>
<p>yields a reasonable fit of the data, as can be inspected using <code>plot(f1, wavelength = "Cu", interactive = TRUE)</code>. To help identify what minerals the variables between 25 and 30 <span class="math inline">\(^\circ2\)</span> 2θ are associated with, the results in <code>f1</code> can be combined with the results in <code>K_usage</code>:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="machine-learning.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a plot of the full pattern summation results</span></span>
<span id="cb163-2"><a href="machine-learning.html#cb163-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(f1, <span class="at">wavelength =</span> <span class="st">&quot;Cu&quot;</span>, <span class="at">group =</span> <span class="cn">TRUE</span>)</span>
<span id="cb163-3"><a href="machine-learning.html#cb163-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-4"><a href="machine-learning.html#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Define the layers for the sticks that will have to be placed</span></span>
<span id="cb163-5"><a href="machine-learning.html#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="co">#BENEATH the data in p1</span></span>
<span id="cb163-6"><a href="machine-learning.html#cb163-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">geom_linerange</span>(<span class="at">data =</span> K_usage,</span>
<span id="cb163-7"><a href="machine-learning.html#cb163-7" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> tth,</span>
<span id="cb163-8"><a href="machine-learning.html#cb163-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymax =</span> (Model<span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span><span class="fu">max</span>(f1<span class="sc">$</span>measured),</span>
<span id="cb163-9"><a href="machine-learning.html#cb163-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymin =</span> <span class="dv">0</span>),</span>
<span id="cb163-10"><a href="machine-learning.html#cb163-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">colour =</span> <span class="st">&quot;grey81&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) </span>
<span id="cb163-11"><a href="machine-learning.html#cb163-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-12"><a href="machine-learning.html#cb163-12" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">geom_linerange</span>(<span class="at">data =</span> K_usage,</span>
<span id="cb163-13"><a href="machine-learning.html#cb163-13" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> tth,</span>
<span id="cb163-14"><a href="machine-learning.html#cb163-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymax =</span> (Conditions<span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span><span class="fu">max</span>(f1<span class="sc">$</span>measured),</span>
<span id="cb163-15"><a href="machine-learning.html#cb163-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymin =</span> <span class="dv">0</span>),</span>
<span id="cb163-16"><a href="machine-learning.html#cb163-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">colour =</span> <span class="st">&quot;grey19&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb163-17"><a href="machine-learning.html#cb163-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-18"><a href="machine-learning.html#cb163-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Order the layers so that p2 and p3 are beneath p1</span></span>
<span id="cb163-19"><a href="machine-learning.html#cb163-19" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">$</span>layers <span class="ot">&lt;-</span> <span class="fu">c</span>(p2, p3, p1<span class="sc">$</span>layers)</span>
<span id="cb163-20"><a href="machine-learning.html#cb163-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-21"><a href="machine-learning.html#cb163-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Limit the x-axis to between 25 and 30 degrees so that the</span></span>
<span id="cb163-22"><a href="machine-learning.html#cb163-22" aria-hidden="true" tabindex="-1"></a><span class="co">#dominant features can be easily examned</span></span>
<span id="cb163-23"><a href="machine-learning.html#cb163-23" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> p1 <span class="sc">+</span></span>
<span id="cb163-24"><a href="machine-learning.html#cb163-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>))</span>
<span id="cb163-25"><a href="machine-learning.html#cb163-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-26"><a href="machine-learning.html#cb163-26" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:advanced-feature-plot"></span>
<img src="DigiMinR_files/figure-html/advanced-feature-plot-1.png" alt="Combining the results from full pattern summation with the features selected by Cubist for prediction of K concentrations." width="100%" />
<p class="caption">
Figure 3.11: Combining the results from full pattern summation with the features selected by Cubist for prediction of K concentrations.
</p>
</div>
<p>To make the data in Figure <a href="machine-learning.html#fig:advanced-feature-plot">3.11</a> interactive, it’s possible to use the <code>ggplotly()</code> function of the <code>plotly</code> package via:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="machine-learning.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(p1)</span></code></pre></div>
<p>From these plots (in particular the interactive version), it is possible to infer that the variables selected by Cubist in this region are specifically related to K-feldspar contributions to the diffraction data. K-feldspar minerals represent the major K-reserves in most soils (though the availability of its potassium to plants is a different matter) and this selection by Cubist is therefore completely appropriate. Further potential mineral sources of other nutrients and micronutrients within this or other datasets can be inferred in a similar manner.</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Butler2018" class="csl-entry">
Butler, Benjamin M, Sharon M O’Rourke, and Stephen Hillier. 2018. <span>“<span class="nocase">Using rule-based regression models to predict and interpret soil properties from X-ray powder diffraction data</span>.”</span> <em>Geoderma</em> 329: 43–53. <a href="https://doi.org/10.1016/j.geoderma.2018.04.005">https://doi.org/10.1016/j.geoderma.2018.04.005</a>.
</div>
<div id="ref-Butler2020" class="csl-entry">
Butler, Benjamin M, Javier Palarea-Albaladejo, Keith D Shepherd, Kamau M Nyambura, Erick K Towett, Andrew M Sila, and Stephen Hillier. 2020. <span>“Mineral–Nutrient Relationships in <span class="nocase">African soils assessed using cluster analysis of X-ray powder diffraction patterns and compositional methods</span>.”</span> <em>Geoderma</em> 375: 114474. <a href="https://doi.org/10.1016/j.geoderma.2020.114474">https://doi.org/10.1016/j.geoderma.2020.114474</a>.
</div>
<div id="ref-Butler2019" class="csl-entry">
Butler, Benjamin M, Andrew M Sila, Keith D Shepherd, Mercy Nyambura, Chris J Gilmore, Nikolaos Kourkoumelis, and Stephen Hillier. 2019. <span>“Pre-Treatment of Soil x-Ray Powder Diffraction Data for Cluster Analysis.”</span> <em>Geoderma</em> 337: 413–24. <a href="https://doi.org/10.1016/j.geoderma.2018.09.044">https://doi.org/10.1016/j.geoderma.2018.09.044</a>.
</div>
<div id="ref-R-leaflet" class="csl-entry">
Cheng, Joe, Bhaskar Karambelkar, and Yihui Xie. 2022. <em>Leaflet: Create Interactive Web Maps with the JavaScript Leaflet Library</em>. <a href="https://rstudio.github.io/leaflet/">https://rstudio.github.io/leaflet/</a>.
</div>
<div id="ref-R-Cubist" class="csl-entry">
Kuhn, Max, and Ross Quinlan. 2022. <em>Cubist: Rule- and Instance-Based Regression Modeling</em>. <a href="https://CRAN.R-project.org/package=Cubist">https://CRAN.R-project.org/package=Cubist</a>.
</div>
<div id="ref-Quinlan1992" class="csl-entry">
Quinlan, John R. 1992. <span>“Learning with Continuous Classes.”</span> In <em>5th Australian Joint Conference on Artificial Intelligence</em>, 92:343–48. World Scientific.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="quant.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cluster-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
