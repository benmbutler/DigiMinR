<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Quantitative phase analysis | Digital Soil Mineralogy with R</title>
  <meta name="description" content="An online course detailing various methods for data-driven analysis of X-ray powder diffraction using R" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Quantitative phase analysis | Digital Soil Mineralogy with R" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/figures/dsm_graphic.png" />
  <meta property="og:description" content="An online course detailing various methods for data-driven analysis of X-ray powder diffraction using R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Quantitative phase analysis | Digital Soil Mineralogy with R" />
  
  <meta name="twitter:description" content="An online course detailing various methods for data-driven analysis of X-ray powder diffraction using R" />
  <meta name="twitter:image" content="/figures/dsm_graphic.png" />

<meta name="author" content="Benjamin Butler and Steve Hillier" />


<meta name="date" content="2022-07-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="machine-learning.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/font-awesome-5.13.0/js/script.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/plotly-binding-4.9.4.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Digital Soil Mineralogy with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code-conventions"><i class="fa fa-check"></i>Code Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-expect"><i class="fa fa-check"></i>What to expect</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Working with XRPD data in R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#basic-form"><i class="fa fa-check"></i><b>1.1</b> The basic form of XRPD data</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#loading-data"><i class="fa fa-check"></i><b>1.2</b> Loading XRPD data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#powDLL"><i class="fa fa-check"></i><b>1.2.1</b> Option 1: PowDLL</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#loading-directly"><i class="fa fa-check"></i><b>1.2.2</b> Option 2: Loading directly into R</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#loading-multiple"><i class="fa fa-check"></i><b>1.2.3</b> Loading multiple files</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#plotting-data"><i class="fa fa-check"></i><b>1.3</b> Plotting XRPD data</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#plotting-xy-objects"><i class="fa fa-check"></i><b>1.3.1</b> Plotting <code>XY</code> objects</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#plotting-multixy-objects"><i class="fa fa-check"></i><b>1.3.2</b> Plotting <code>multiXY</code> objects</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#ggplot2-intro"><i class="fa fa-check"></i><b>1.3.3</b> Modifying plots with <strong>ggplot2</strong></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#manipulating-data"><i class="fa fa-check"></i><b>1.4</b> Manipulating XRPD data</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#subsetting"><i class="fa fa-check"></i><b>1.4.1</b> Subsetting XRPD data</a></li>
<li class="chapter" data-level="1.4.2" data-path="intro.html"><a href="intro.html#transformations"><i class="fa fa-check"></i><b>1.4.2</b> Transformations of count intensities</a></li>
<li class="chapter" data-level="1.4.3" data-path="intro.html"><a href="intro.html#interpolation"><i class="fa fa-check"></i><b>1.4.3</b> Interpolation</a></li>
<li class="chapter" data-level="1.4.4" data-path="intro.html"><a href="intro.html#alignment"><i class="fa fa-check"></i><b>1.4.4</b> Alignment</a></li>
<li class="chapter" data-level="1.4.5" data-path="intro.html"><a href="intro.html#background"><i class="fa fa-check"></i><b>1.4.5</b> Background fitting</a></li>
<li class="chapter" data-level="1.4.6" data-path="intro.html"><a href="intro.html#to-data-frame"><i class="fa fa-check"></i><b>1.4.6</b> Converting to and from data frames</a></li>
<li class="chapter" data-level="1.4.7" data-path="intro.html"><a href="intro.html#two-theta-transform"><i class="fa fa-check"></i><b>1.4.7</b> 2θ transformation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="quant.html"><a href="quant.html"><i class="fa fa-check"></i><b>2</b> Quantitative phase analysis</a>
<ul>
<li class="chapter" data-level="2.1" data-path="quant.html"><a href="quant.html#full-pattern-summation-with-powdr"><i class="fa fa-check"></i><b>2.1</b> Full pattern summation with <strong>powdR</strong></a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="quant.html"><a href="quant.html#powdRlib"><i class="fa fa-check"></i><b>2.1.1</b> The <code>powdRlib</code> object</a></li>
<li class="chapter" data-level="2.1.2" data-path="quant.html"><a href="quant.html#full-pattern-summation-with-fps"><i class="fa fa-check"></i><b>2.1.2</b> Full pattern summation with <code>fps()</code></a></li>
<li class="chapter" data-level="2.1.3" data-path="quant.html"><a href="quant.html#afps"><i class="fa fa-check"></i><b>2.1.3</b> Automated full pattern summation with <code>afps()</code></a></li>
<li class="chapter" data-level="2.1.4" data-path="quant.html"><a href="quant.html#additional-fps-and-afps-functionality"><i class="fa fa-check"></i><b>2.1.4</b> Additional <code>fps()</code> and <code>afps()</code> functionality</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="quant.html"><a href="quant.html#plotting-powdrfps-and-powdrafps-objects"><i class="fa fa-check"></i><b>2.2</b> Plotting <code>powdRfps</code> and <code>powdRafps</code> objects</a></li>
<li class="chapter" data-level="2.3" data-path="quant.html"><a href="quant.html#quantifying-multiple-samples"><i class="fa fa-check"></i><b>2.3</b> Quantifying multiple samples</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="quant.html"><a href="quant.html#lapply"><i class="fa fa-check"></i><b>2.3.1</b> <code>lapply()</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="quant.html"><a href="quant.html#parallel-processing"><i class="fa fa-check"></i><b>2.3.2</b> Parallel processing</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="quant.html"><a href="quant.html#summarising-mineralogy"><i class="fa fa-check"></i><b>2.4</b> Summarising mineralogy</a></li>
<li class="chapter" data-level="2.5" data-path="quant.html"><a href="quant.html#the-powdr-shiny-app"><i class="fa fa-check"></i><b>2.5</b> The powdR Shiny app</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>3</b> Machine learning with soil XRPD data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="machine-learning.html"><a href="machine-learning.html#loading-packages-and-data"><i class="fa fa-check"></i><b>3.1</b> Loading packages and data</a></li>
<li class="chapter" data-level="3.2" data-path="machine-learning.html"><a href="machine-learning.html#cubist-exploration"><i class="fa fa-check"></i><b>3.2</b> Data exploration</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="machine-learning.html"><a href="machine-learning.html#spatial-data"><i class="fa fa-check"></i><b>3.2.1</b> Spatial data</a></li>
<li class="chapter" data-level="3.2.2" data-path="machine-learning.html"><a href="machine-learning.html#geochemical-data"><i class="fa fa-check"></i><b>3.2.2</b> Geochemical data</a></li>
<li class="chapter" data-level="3.2.3" data-path="machine-learning.html"><a href="machine-learning.html#xrpd-data"><i class="fa fa-check"></i><b>3.2.3</b> XRPD data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="machine-learning.html"><a href="machine-learning.html#cubist-pretreatment"><i class="fa fa-check"></i><b>3.3</b> Data pre-treatment</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="machine-learning.html"><a href="machine-learning.html#alignment-1"><i class="fa fa-check"></i><b>3.3.1</b> Alignment</a></li>
<li class="chapter" data-level="3.3.2" data-path="machine-learning.html"><a href="machine-learning.html#subsetting-1"><i class="fa fa-check"></i><b>3.3.2</b> Subsetting</a></li>
<li class="chapter" data-level="3.3.3" data-path="machine-learning.html"><a href="machine-learning.html#mean-centering"><i class="fa fa-check"></i><b>3.3.3</b> Mean centering</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="machine-learning.html"><a href="machine-learning.html#creation-of-training-and-test-datasets"><i class="fa fa-check"></i><b>3.4</b> Creation of training and test datasets</a></li>
<li class="chapter" data-level="3.5" data-path="machine-learning.html"><a href="machine-learning.html#using-cubist"><i class="fa fa-check"></i><b>3.5</b> Using Cubist</a></li>
<li class="chapter" data-level="3.6" data-path="machine-learning.html"><a href="machine-learning.html#inspection-of-cubist-models"><i class="fa fa-check"></i><b>3.6</b> Inspection of Cubist models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cluster-analysis.html"><a href="cluster-analysis.html"><i class="fa fa-check"></i><b>4</b> Cluster analysis of soil XRPD data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cluster-analysis.html"><a href="cluster-analysis.html#loading-packages-and-data-1"><i class="fa fa-check"></i><b>4.1</b> Loading packages and data</a></li>
<li class="chapter" data-level="4.2" data-path="cluster-analysis.html"><a href="cluster-analysis.html#clustering-pca"><i class="fa fa-check"></i><b>4.2</b> Principal component analysis</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="cluster-analysis.html"><a href="cluster-analysis.html#interpreting-principal-components"><i class="fa fa-check"></i><b>4.2.1</b> Interpreting principal components</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="cluster-analysis.html"><a href="cluster-analysis.html#fuzzy-clustering"><i class="fa fa-check"></i><b>4.3</b> Fuzzy clustering</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="cluster-analysis.html"><a href="cluster-analysis.html#cluster-membership"><i class="fa fa-check"></i><b>4.3.1</b> Cluster membership</a></li>
<li class="chapter" data-level="4.3.2" data-path="cluster-analysis.html"><a href="cluster-analysis.html#subsetting-clusters"><i class="fa fa-check"></i><b>4.3.2</b> Subsetting Clusters</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="cluster-analysis.html"><a href="cluster-analysis.html#exploring-results"><i class="fa fa-check"></i><b>4.4</b> Exploring results</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mars.html"><a href="mars.html"><i class="fa fa-check"></i><b>5</b> From Mars to Mull: Interplanetary comparison of soil XRPD data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="mars.html"><a href="mars.html#mars-package"><i class="fa fa-check"></i><b>5.1</b> Required packages</a></li>
<li class="chapter" data-level="5.2" data-path="mars.html"><a href="mars.html#datasets"><i class="fa fa-check"></i><b>5.2</b> Datasets</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="mars.html"><a href="mars.html#mars-data"><i class="fa fa-check"></i><b>5.2.1</b> Mars Science Laboratory XRPD Data</a></li>
<li class="chapter" data-level="5.2.2" data-path="mars.html"><a href="mars.html#mars-scotland-data"><i class="fa fa-check"></i><b>5.2.2</b> Scottish Soil XRPD data</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="mars.html"><a href="mars.html#mars-manipulation"><i class="fa fa-check"></i><b>5.3</b> Data manipulation</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="mars.html"><a href="mars.html#θ-transformation"><i class="fa fa-check"></i><b>5.3.1</b> 2θ transformation</a></li>
<li class="chapter" data-level="5.3.2" data-path="mars.html"><a href="mars.html#θ-interpolation"><i class="fa fa-check"></i><b>5.3.2</b> 2θ interpolation</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="mars.html"><a href="mars.html#comparison-of-xrpd-data"><i class="fa fa-check"></i><b>5.4</b> Comparison of XRPD data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Digital Soil Mineralogy with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="quant" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Quantitative phase analysis<a href="quant.html#quant" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter describes methods for quantitative analysis implemented within the <strong>powdR</strong> package using a range of reproducible examples. Detailed accounts of these methods are provided in <span class="citation">Butler and Hillier (<a href="#ref-Butler2021rc" role="doc-biblioref">2021a</a>)</span> and <span class="citation">Butler and Hillier (<a href="#ref-Butler2021powdR" role="doc-biblioref">2021b</a>)</span> and references therein.</p>
<p>One of the most powerful properties of XRPD data is that the intensities of crystalline (e.g., quartz, calcite and gypsum), disordered (e.g., clay minerals), and amorphous (e.g., volcanic glass and organic matter) scattering signals within a diffractogram can be related to the concentrations of these components within the mixture. This principal facilitates the quantification of phase concentrations from XRPD data.</p>
<p>Of the approaches available for quantitative XRPD, the simple Reference Intensity Ratio (RIR) method has consistently proven accurate. A RIR is a measure of the diffracting power of a phase relative to that of a standard (most often corundum, α Al<sub>2</sub>O<sub>3</sub>), usually measured in a 50:50 mixture by weight. The RIR of a detectable phase within a mixture is required for its quantification.</p>
<p>As mentioned in Chapter <a href="intro.html#intro">1</a>, a given diffractogram can be modeled as the sum of pure diffractograms for all detectable phases, each scaled by different amounts (scaling factors). By combining these scaling factors with RIRs, phase concentrations can be calculated. Hereafter this approach is referred to as <strong>full pattern summation</strong>.</p>
<p>Full pattern summation is particularly suitable for mixtures containing crystalline mineral components in combination with disordered and/or X-ray amorphous phases because the background scattering is also included. Soil is a prime example of such mixtures, where crystalline minerals such as quartz and feldspars can be present in combination with clay minerals (i.e. disordered phases), and organic matter (i.e. amorphous phases). A key component of the full pattern summation approach is the “reference library” containing measured or calculated patterns of the pure phases that may be encountered within the samples. The reference patterns within the library would ideally be measured on the same instrument as the sample, however in some cases this isn’t possible and the data can be harmonised accordingly, at least in some respects. To quantify a given sample, suitable phases from the library are selected that together account for the peaks within the data, and their relative contributions to the observed signal optimised until an appropriate full pattern fit is achieved. This fit is usually refined using least squares optimisation of an objective parameter. The scaled intensities of the optimised patterns are then converted to weight % using the RIRs <span class="citation">(see Section 2 in <a href="#ref-Butler2021rc" role="doc-biblioref">Butler and Hillier 2021a</a>)</span>.</p>
<div id="full-pattern-summation-with-powdr" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Full pattern summation with <strong>powdR</strong><a href="quant.html#full-pattern-summation-with-powdr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="powdRlib" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> The <code>powdRlib</code> object<a href="quant.html#powdRlib" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/3XorZfqAKo4" frameborder="0" allowfullscreen>
</iframe>
</p>
<p>A key component of the full pattern summation functions within <strong>powdR</strong> is the library of reference patterns. These are stored within a <code>powdRlib</code> object created from two basic components using the <code>powdRlib()</code> constructor function. The first component, specified via the <code>xrd_table</code> argument of <code>powdRlib()</code>, is a data frame of the count intensities of the reference patterns, with their 2θ axis as the first column. The column for a given reference pattern must be named using a unique identifier (a phase ID). An example of such a format is provided in the <code>minerals_xrd</code> data:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="quant.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(powdR)</span>
<span id="cb63-2"><a href="quant.html#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="quant.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(minerals_xrd)</span>
<span id="cb63-4"><a href="quant.html#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="quant.html#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(minerals_xrd)</span></code></pre></div>
<pre><code>##       tth QUA.1 QUA.2 FEL ORT SAN ALB OLI DOL.1 DOL.2  ILL KAO GOE.1 GOE.2  ORG
## 1 4.00973    69    91 546 599 638 308 343   268   362 3078 525  3549 10000 3225
## 2 4.04865    69    92 524 570 609 294 332   256   345 2960 500  3511  9592 3180
## 3 4.08757    64    86 505 555 582 286 328   250   343 2888 486  3401  9323 3135
## 4 4.12649    64    83 512 543 558 277 310   247   327 2753 474  3290  9042 3092
## 5 4.16541    62    83 478 518 536 275 304   241   318 2718 478  3194  9248 3050
## 6 4.20433    60    81 459 514 517 261 298   228   314 2720 447  3113  8557 3010</code></pre>
<p>The second component required to build a <code>powdRlib</code> object, specified via the <code>phases_table</code> argument of <code>powdRlib()</code>, is a data frame containing 3 columns. The first column is a string of unique ID’s corrensponding to the names of each reference pattern in the data provided to the <code>xrd_table</code> argument outlined above. The second column is the name of the phase group that this reference pattern belongs to (e.g. quartz, plagioclase, Illite etc). The third column is the reference intensity ratio (RIR) of that reference pattern (relative to a known standard, usually corundum). An example of the format required for the <code>phases_table</code> argument of <code>powRlib()</code> is provided in the <code>minerals_phases</code> data.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="quant.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(minerals_phases)</span>
<span id="cb65-2"><a href="quant.html#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="quant.html#cb65-3" aria-hidden="true" tabindex="-1"></a>minerals_phases</span></code></pre></div>
<pre><code>##    phase_id     phase_name  rir
## 1     QUA.1         Quartz 4.62
## 2     QUA.2         Quartz 4.34
## 3       FEL     K-feldspar 0.75
## 4       ORT     K-feldspar 1.03
## 5       SAN     K-feldspar 0.93
## 6       ALB    Plagioclase 1.31
## 7       OLI    Plagioclase 1.06
## 8     DOL.1       Dolomite 2.35
## 9     DOL.2       Dolomite 2.39
## 10      ILL         Illite 0.22
## 11      KAO      Kaolinite 0.91
## 12    GOE.1       Goethite 0.93
## 13    GOE.2       Goethite 0.37
## 14      ORG Organic-Matter 0.07</code></pre>
<p>Crucially when building the <code>powdRlib</code> object, all phase ID’s in the first column of the <code>phases_table</code> must match the column names of the <code>xrd_table</code> (excluding the name of the first column which is the 2θ axis), for example.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="quant.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">names</span>(minerals_xrd[<span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb67-2"><a href="quant.html#cb67-2" aria-hidden="true" tabindex="-1"></a>          minerals_phases<span class="sc">$</span>phase_id)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Once created, <code>powdRlib</code> objects can easily be visualised using the associated <code>plot()</code> method (see <code>?plot.powdRlib</code>), which accepts the arguments <code>wavelength</code>, <code>refs</code> and <code>interactive</code> that are used to specify the X-ray wavelength, the reference patterns to plot, and the output format, respectively. In all cases where <code>plot()</code> is used in this chapter, the use of <code>interactive = TRUE</code> in the function call will produce an interactive html graph that can be viewed in RStudio or a web browser.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="quant.html#cb69-1" aria-hidden="true" tabindex="-1"></a>my_lib <span class="ot">&lt;-</span> <span class="fu">powdRlib</span>(minerals_xrd, minerals_phases)</span>
<span id="cb69-2"><a href="quant.html#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="quant.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_lib, <span class="at">wavelength =</span> <span class="st">&quot;Cu&quot;</span>,</span>
<span id="cb69-4"><a href="quant.html#cb69-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">refs =</span> <span class="fu">c</span>(<span class="st">&quot;ALB&quot;</span>, <span class="st">&quot;DOL.1&quot;</span>,</span>
<span id="cb69-5"><a href="quant.html#cb69-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;QUA.1&quot;</span>, <span class="st">&quot;GOE.2&quot;</span>),</span>
<span id="cb69-6"><a href="quant.html#cb69-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">interactive =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-45"></span>
<img src="DigiMinR_files/figure-html/unnamed-chunk-45-1.png" alt="Plotting selected reference patterns from a powdRlib object." width="80%" />
<p class="caption">
Figure 2.1: Plotting selected reference patterns from a powdRlib object.
</p>
</div>
<div id="rockjock" class="section level4 hasAnchor" number="2.1.1.1">
<h4><span class="header-section-number">2.1.1.1</span> Pre-loaded <code>powdRlib</code> objects<a href="quant.html#rockjock" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are two <code>powdRlib</code> objects provided as part of the <strong>powdR</strong> package. The first is <code>minerals</code> [accessed via <code>data(minerals)</code>], which is a simple and low resolution library designed to facilitate fast computation of basic examples. The second is <code>rockjock</code> [accessed via <code>data(rockjock)</code>], which is a comprehensive library of 169 reference patterns covering most phases that might be encountered in geological and soil samples. The <code>rockjock</code> library in <strong>powdR</strong> uses data from the original RockJock program <span class="citation">(<a href="#ref-Eberl2003" role="doc-biblioref">Eberl 2003</a>)</span> thanks to the permission of Dennis Eberl. In <code>rockjock</code>, each reference pattern from the original RockJock program has been scaled to a maximum intensity of 10000 counts, and the RIRs normalised relative to Corundum. All <code>rockjock</code> data were analysed using Cu K<span class="math inline">\(\alpha\)</span> radiation. The final library is <code>afsis</code> [accessed via <code>data(minerals)</code>], which contains 21 reference patterns measured on a Bruker D2 phaser as part of the XRPD data analysis undertaken for Africa Soil Information Service Sentinel Site programme.</p>
<p>To accompany the <code>rockjock</code> reference library, a list of eight synthetic mixtures from the original RockJock program <span class="citation">(<a href="#ref-Eberl2003" role="doc-biblioref">Eberl 2003</a>)</span> are also included in <strong>powdR</strong> in the <code>rockjock_mixtures</code> data [accessed via <code>data(rockjock_mixtures)</code>], and the known compositions of these mixtures provided in the <code>rockjock_weights</code> data [accessed via <code>data(rockjock_weights)</code>].</p>
</div>
<div id="subsetting-a-powdrlib-object" class="section level4 hasAnchor" number="2.1.1.2">
<h4><span class="header-section-number">2.1.1.2</span> Subsetting a <code>powdRlib</code> object<a href="quant.html#subsetting-a-powdrlib-object" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Occasionally it may be useful to subset a reference library to a smaller selection. This can be achieved using <code>subset()</code>, which for <code>powdRlib</code> objects accepts three arguments; <code>x</code>, <code>refs</code> and <code>mode</code> (see <code>?subset.powdRlib</code>). The <code>x</code> argument specifies the <code>powdRlib</code> object to be subset, <code>refs</code> specifies the ID’s and/or names of phases to select, and <code>mode</code> specifies whether these phases are kept (<code>mode = "keep"</code>) or removed (<code>mode = "remove"</code>).</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="quant.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(rockjock)</span>
<span id="cb70-2"><a href="quant.html#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="quant.html#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Have a look at the phase ID&#39;s in rockjock</span></span>
<span id="cb70-4"><a href="quant.html#cb70-4" aria-hidden="true" tabindex="-1"></a>rockjock<span class="sc">$</span>phases<span class="sc">$</span>phase_id[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##  [1] &quot;CORUNDUM&quot;                &quot;BACK_POS&quot;               
##  [3] &quot;BACK_NEG&quot;                &quot;QUARTZ&quot;                 
##  [5] &quot;ORDERED_MICROCLINE&quot;      &quot;INTERMEDIATE_MICROCLINE&quot;
##  [7] &quot;SANIDINE&quot;                &quot;ORTHOCLASE&quot;             
##  [9] &quot;ANORTHOCLASE&quot;            &quot;ALBITE_CLEAVELANDITE&quot;</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="quant.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove reference patterns from rockjock</span></span>
<span id="cb72-2"><a href="quant.html#cb72-2" aria-hidden="true" tabindex="-1"></a>rockjock_1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(rockjock,</span>
<span id="cb72-3"><a href="quant.html#cb72-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">refs =</span> <span class="fu">c</span>(<span class="st">&quot;ALUNITE&quot;</span>, <span class="co">#phase ID</span></span>
<span id="cb72-4"><a href="quant.html#cb72-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;AMPHIBOLE&quot;</span>, <span class="co">#phase ID</span></span>
<span id="cb72-5"><a href="quant.html#cb72-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ANALCIME&quot;</span>, <span class="co">#phase ID</span></span>
<span id="cb72-6"><a href="quant.html#cb72-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;Plagioclase&quot;</span>), <span class="co">#phase name</span></span>
<span id="cb72-7"><a href="quant.html#cb72-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mode =</span> <span class="st">&quot;remove&quot;</span>)</span>
<span id="cb72-8"><a href="quant.html#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="quant.html#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Check number of reference patterns remaining in library</span></span>
<span id="cb72-10"><a href="quant.html#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(rockjock_1<span class="sc">$</span>phases)</span></code></pre></div>
<pre><code>## [1] 157</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="quant.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Keep certain reference patterns of rockjock</span></span>
<span id="cb74-2"><a href="quant.html#cb74-2" aria-hidden="true" tabindex="-1"></a>rockjock_2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(rockjock,</span>
<span id="cb74-3"><a href="quant.html#cb74-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">refs =</span> <span class="fu">c</span>(<span class="st">&quot;ALUNITE&quot;</span>, <span class="co">#phase ID</span></span>
<span id="cb74-4"><a href="quant.html#cb74-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;AMPHIBOLE&quot;</span>, <span class="co">#phase ID</span></span>
<span id="cb74-5"><a href="quant.html#cb74-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ANALCIME&quot;</span>, <span class="co">#phase ID</span></span>
<span id="cb74-6"><a href="quant.html#cb74-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;Plagioclase&quot;</span>), <span class="co">#phase name</span></span>
<span id="cb74-7"><a href="quant.html#cb74-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mode =</span> <span class="st">&quot;keep&quot;</span>)</span>
<span id="cb74-8"><a href="quant.html#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="quant.html#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Check number of reference patterns remaining</span></span>
<span id="cb74-10"><a href="quant.html#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(rockjock_2<span class="sc">$</span>phases)</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
</div>
<div id="interpolating-and-merging-powdrlib-objects" class="section level4 hasAnchor" number="2.1.1.3">
<h4><span class="header-section-number">2.1.1.3</span> Interpolating and merging <code>powdRlib</code> objects<a href="quant.html#interpolating-and-merging-powdrlib-objects" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Two <code>powdRlib</code> objects from different instruments can be interpolated and then merged using the <code>interpolate</code> and <code>merge</code> methods (see <code>?interpolate.powdRlib</code> and <code>merge.powdRlib</code>), respectively. For example, the <code>minerals</code> library can be merged with the <code>rockjock</code> library following interpolation using:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="quant.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the minerals library</span></span>
<span id="cb76-2"><a href="quant.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(minerals)</span>
<span id="cb76-3"><a href="quant.html#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="quant.html#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Check the number of reference patterns</span></span>
<span id="cb76-5"><a href="quant.html#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(minerals<span class="sc">$</span>phases)</span></code></pre></div>
<pre><code>## [1] 14</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="quant.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check the number of reference patterns in rockjock</span></span>
<span id="cb78-2"><a href="quant.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(rockjock<span class="sc">$</span>phases)</span></code></pre></div>
<pre><code>## [1] 168</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="quant.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#interpolate minerals library onto same 2theta as rockjock</span></span>
<span id="cb80-2"><a href="quant.html#cb80-2" aria-hidden="true" tabindex="-1"></a>minerals_i <span class="ot">&lt;-</span> <span class="fu">interpolate</span>(minerals,</span>
<span id="cb80-3"><a href="quant.html#cb80-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">new_tth =</span> rockjock<span class="sc">$</span>tth)</span>
<span id="cb80-4"><a href="quant.html#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="quant.html#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co">#merge the libraries</span></span>
<span id="cb80-6"><a href="quant.html#cb80-6" aria-hidden="true" tabindex="-1"></a>merged_lib <span class="ot">&lt;-</span> <span class="fu">merge</span>(rockjock, minerals_i)</span>
<span id="cb80-7"><a href="quant.html#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="quant.html#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Check the number of reference patterns in the merged library</span></span>
<span id="cb80-9"><a href="quant.html#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(merged_lib<span class="sc">$</span>phases)</span></code></pre></div>
<pre><code>## [1] 182</code></pre>
<p>In simpler cases where two libraries are already on the same 2θ axis and were measured using the same instrumental parameters, only the use of <code>merge()</code> would be required.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="quant.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the afsis library</span></span>
<span id="cb82-2"><a href="quant.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(afsis)</span>
<span id="cb82-3"><a href="quant.html#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="quant.html#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(rockjock<span class="sc">$</span>tth, afsis<span class="sc">$</span>tth)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="quant.html#cb84-1" aria-hidden="true" tabindex="-1"></a>rockjock_afsis <span class="ot">&lt;-</span> <span class="fu">merge</span>(rockjock, afsis)</span></code></pre></div>
</div>
</div>
<div id="full-pattern-summation-with-fps" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Full pattern summation with <code>fps()</code><a href="quant.html#full-pattern-summation-with-fps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/5PdRaLmJumE" frameborder="0" allowfullscreen>
</iframe>
</p>
<p>Once you have a <code>powdRlib</code> reference library and diffractogram(s) <a href="intro.html#loading-data">loaded into R</a>, you have everything needed for quantitative analysis via full pattern summation. Full pattern summation in <strong>powdR</strong> is provided via the <code>fps()</code> function, whilst an automated version is provided in <a href="quant.html#afps"><code>afps()</code></a>. Details of the equations and routines implemented in <code>fps()</code> and <code>afps()</code> are provided in <span class="citation">Butler and Hillier (<a href="#ref-Butler2021rc" role="doc-biblioref">2021a</a>)</span> and <span class="citation">Butler and Hillier (<a href="#ref-Butler2021powdR" role="doc-biblioref">2021b</a>)</span>.</p>
<p><code>fps()</code> is specifically applied to <code>powdRlib</code> objects, and accepts a wide range of arguments that are detailed in the package documentation (see <code>?fps.powdRlib</code>). Here the <a href="quant.html#rockjock"><code>rockjock</code> and <code>rockjock_mixtures</code> data</a> will be used to demonstrate the main features of <code>fps()</code> and the various ways in which it can be used.</p>
<div id="full-pattern-summation-with-an-internal-standard" class="section level4 hasAnchor" number="2.1.2.1">
<h4><span class="header-section-number">2.1.2.1</span> Full pattern summation <strong>with</strong> an internal standard<a href="quant.html#full-pattern-summation-with-an-internal-standard" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Often samples are prepared for XRPD analysis with an internal standard of known concentration. If this is the case, then the <code>std</code> and <code>std_conc</code> arguments of <code>fps()</code> can be used to define the internal standard and its concentration (in weight %), respectively, which is then used in combination with the reference intensity ratios to compute phase concentrations. For example, all samples in the <code>rockjock_mixtures</code> data were prepared with 20 % corundum as the added internal standard, thus this can be specified using <code>std = "CORUNDUM"</code> and <code>std_conc = 20</code> in the call to <code>fps()</code>. In addition, setting the <code>omit_std</code> argument to <code>TRUE</code> makes sure that the internal standard concentration will be omitted from the output and the phase concentrations recomputed accordingly. In such cases the phase specified as the internal standard can also be used in combination with the value specified in the <code>align</code> argument to ensure that the measured diffractogram is appropriately aligned on the 2θ axis using the alignment approach outlined <a href="intro.html#alignment">above</a>. These principles are used in the example below, which passes the following seven arguments to <code>fps()</code>:</p>
<ol style="list-style-type: decimal">
<li><code>lib</code> is used to define the <a href="quant.html#powdRlib"><code>powdRlib</code> object</a> containing the reference patterns and their RIRs.</li>
<li><code>smpl</code> is used to defined the data frame or <a href="intro.html#loading-data"><code>XY</code> object</a> containing the sample diffractogram.</li>
<li><code>refs</code> is used to define a string of phase IDs (<code>lib$phases$phase_id</code>) and/or phase names (<code>lib$phases$phase_names</code>) of the reference patterns to be used in the fitting process.</li>
<li><code>std</code> is used to define the phase ID of the reference pattern to be used as the internal standard.</li>
<li><code>std_conc</code> is used to define the concentration of the internal standard in weight %.</li>
<li><code>omit_std</code> is used to define whether the internal standard is omitted from the output and phase concentrations recomputed accordingly.</li>
<li><code>align</code> is used to define the maximum positive or negative shift in 2θ that is permitted during <a href="intro.html#alignment">alignment</a> of the sample to the reference pattern that is specified in the <code>std</code> argument.</li>
</ol>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="quant.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(rockjock_mixtures)</span>
<span id="cb85-2"><a href="quant.html#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="quant.html#cb85-3" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">fps</span>(<span class="at">lib =</span> rockjock,</span>
<span id="cb85-4"><a href="quant.html#cb85-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">smpl =</span> rockjock_mixtures<span class="sc">$</span>Mix1,</span>
<span id="cb85-5"><a href="quant.html#cb85-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">refs =</span> <span class="fu">c</span>(<span class="st">&quot;ORDERED_MICROCLINE&quot;</span>,</span>
<span id="cb85-6"><a href="quant.html#cb85-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Plagioclase&quot;</span>,</span>
<span id="cb85-7"><a href="quant.html#cb85-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;KAOLINITE_DRY_BRANCH&quot;</span>,</span>
<span id="cb85-8"><a href="quant.html#cb85-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;MONTMORILLONITE_WYO&quot;</span>,</span>
<span id="cb85-9"><a href="quant.html#cb85-9" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;ILLITE_1M_RM30&quot;</span>,</span>
<span id="cb85-10"><a href="quant.html#cb85-10" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;CORUNDUM&quot;</span>),</span>
<span id="cb85-11"><a href="quant.html#cb85-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">std =</span> <span class="st">&quot;CORUNDUM&quot;</span>,</span>
<span id="cb85-12"><a href="quant.html#cb85-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">std_conc =</span> <span class="dv">20</span>,</span>
<span id="cb85-13"><a href="quant.html#cb85-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">omit_std =</span> <span class="cn">TRUE</span>,</span>
<span id="cb85-14"><a href="quant.html#cb85-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">align =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<pre><code>## 
## -Aligning sample to the internal standard
## -Interpolating library to same 2theta scale as aligned sample
## -Optimising...
## -Removing negative coefficients and reoptimising...
## -Removing negative coefficients and reoptimising...
## -Computing phase concentrations
## -Using internal standard concentration of 20 % to compute phase concentrations
## -Omitting internal standard from phase concentrations
## ***Full pattern summation complete***</code></pre>
<p>Once computed, the <code>fps()</code> function produces a <code>powdRfps</code> object, which is a bundle of data in list format that contains the outputs (see <code>?fps.powdRlib</code>).</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="quant.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1)</span></code></pre></div>
<pre><code>##                        Length Class      Mode   
## tth                    2989   -none-     numeric
## fitted                 2989   -none-     numeric
## measured               2989   -none-     numeric
## residuals              2989   -none-     numeric
## phases                    4   data.frame list   
## phases_grouped            2   data.frame list   
## obj                       3   -none-     numeric
## weighted_pure_patterns    7   data.frame list   
## coefficients              7   -none-     numeric
## inputs                   16   -none-     list</code></pre>
<p>The phase concentrations can be accessed in the <code>phases</code> data frame of the <code>powdRfps</code> object:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="quant.html#cb89-1" aria-hidden="true" tabindex="-1"></a>fit1<span class="sc">$</span>phases</span></code></pre></div>
<pre><code>##               phase_id    phase_name       rir phase_percent
## 1             CORUNDUM      Corundum 1.0000000            NA
## 2   ORDERED_MICROCLINE    K-feldspar 0.9654312      3.777500
## 3             ANDESINE   Plagioclase 0.8206422      4.660500
## 4          LABRADORITE   Plagioclase 0.8113040     20.397000
## 5 KAOLINITE_DRY_BRANCH     Kaolinite 0.5812875     14.654375
## 6       ILLITE_1M_RM30        Illite 0.2768664      7.666375
## 7  MONTMORILLONITE_WYO Smectite (Di) 0.3202779     50.955000</code></pre>
<p>Further, notice that if the concentration of the internal standard is specified then the phase concentrations do not necessarily sum to 100 % because each phase is quantified with respect to the internal standard:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="quant.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(fit1<span class="sc">$</span>phases<span class="sc">$</span>phase_percent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 102.1108</code></pre>
<p>Unlike other software where only certain phases can be used as an internal standard, any phase can be defined in <strong>powdR</strong>. For example, the <code>rockjock_mixtures$Mix5</code> sample contains 20 % quartz (see <code>data(rockjock_weights)</code>), thus adding <code>"QUARTZ"</code> as the <code>std</code> argument results in this reference pattern becoming the internal standard instead.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="quant.html#cb93-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">fps</span>(<span class="at">lib =</span> rockjock,</span>
<span id="cb93-2"><a href="quant.html#cb93-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">smpl =</span> rockjock_mixtures<span class="sc">$</span>Mix5,</span>
<span id="cb93-3"><a href="quant.html#cb93-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">refs =</span> <span class="fu">c</span>(<span class="st">&quot;ORDERED_MICROCLINE&quot;</span>,</span>
<span id="cb93-4"><a href="quant.html#cb93-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Plagioclase&quot;</span>,</span>
<span id="cb93-5"><a href="quant.html#cb93-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;KAOLINITE_DRY_BRANCH&quot;</span>,</span>
<span id="cb93-6"><a href="quant.html#cb93-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;MONTMORILLONITE_WYO&quot;</span>,</span>
<span id="cb93-7"><a href="quant.html#cb93-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;CORUNDUM&quot;</span>,</span>
<span id="cb93-8"><a href="quant.html#cb93-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;QUARTZ&quot;</span>),</span>
<span id="cb93-9"><a href="quant.html#cb93-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">std =</span> <span class="st">&quot;QUARTZ&quot;</span>,</span>
<span id="cb93-10"><a href="quant.html#cb93-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">std_conc =</span> <span class="dv">20</span>,</span>
<span id="cb93-11"><a href="quant.html#cb93-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">omit_std =</span> <span class="cn">TRUE</span>,</span>
<span id="cb93-12"><a href="quant.html#cb93-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">align =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<pre><code>## 
## -Aligning sample to the internal standard
## -Interpolating library to same 2theta scale as aligned sample
## -Optimising...
## -Removing negative coefficients and reoptimising...
## -Removing negative coefficients and reoptimising...
## -Computing phase concentrations
## -Using internal standard concentration of 20 % to compute phase concentrations
## -Omitting internal standard from phase concentrations
## ***Full pattern summation complete***</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="quant.html#cb95-1" aria-hidden="true" tabindex="-1"></a>fit2<span class="sc">$</span>phases</span></code></pre></div>
<pre><code>##               phase_id    phase_name       rir phase_percent
## 1             CORUNDUM      Corundum 1.0000000     24.893750
## 2               QUARTZ        Quartz 3.5404393            NA
## 3   ORDERED_MICROCLINE    K-feldspar 0.9654312     39.810500
## 4         ANORTHOCLASE   Plagioclase 0.5804293      3.597250
## 5             ANDESINE   Plagioclase 0.8206422      2.626125
## 6          LABRADORITE   Plagioclase 0.8113040      3.474375
## 7            ANORTHITE   Plagioclase 0.5294816      2.744125
## 8 KAOLINITE_DRY_BRANCH     Kaolinite 0.5812875      5.332125
## 9  MONTMORILLONITE_WYO Smectite (Di) 0.3202779     12.902250</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="quant.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(fit2<span class="sc">$</span>phases<span class="sc">$</span>phase_percent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 95.3805</code></pre>
<p>It’s also possible to “close” the mineral composition so that the weight percentages sum to 100. This can be achieved in two ways:</p>
<ol style="list-style-type: decimal">
<li>By defining <code>closed = TRUE</code> in the <code>fps()</code> function call.</li>
<li>By applying the <code>close_quant()</code> function to the <code>powdRfps</code> output.</li>
</ol>
<p>For example, the phase composition in <code>fit2</code> created above can be closed using:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="quant.html#cb99-1" aria-hidden="true" tabindex="-1"></a>fit2c <span class="ot">&lt;-</span> <span class="fu">close_quant</span>(fit2)</span>
<span id="cb99-2"><a href="quant.html#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="quant.html#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(fit2c<span class="sc">$</span>phases<span class="sc">$</span>phase_percent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 100</code></pre>
</div>
<div id="full-pattern-summation-without-an-internal-standard" class="section level4 hasAnchor" number="2.1.2.2">
<h4><span class="header-section-number">2.1.2.2</span> Full pattern summation <strong>without</strong> an internal standard<a href="quant.html#full-pattern-summation-without-an-internal-standard" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In cases where an internal standard is not added to a sample, phase quantification can be achieved by assuming that all detectable phases can be identified and that they sum to 100 weight %. By setting the <code>std_conc</code> argument of <code>fps()</code> to <code>NA</code>, or leaving it out of the function call, it will be assumed that the sample has been prepared without an internal standard and the phase concentrations computed accordingly.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="quant.html#cb101-1" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">fps</span>(<span class="at">lib =</span> rockjock,</span>
<span id="cb101-2"><a href="quant.html#cb101-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">smpl =</span> rockjock_mixtures<span class="sc">$</span>Mix1,</span>
<span id="cb101-3"><a href="quant.html#cb101-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">refs =</span> <span class="fu">c</span>(<span class="st">&quot;ORDERED_MICROCLINE&quot;</span>,</span>
<span id="cb101-4"><a href="quant.html#cb101-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Plagioclase&quot;</span>,</span>
<span id="cb101-5"><a href="quant.html#cb101-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;KAOLINITE_DRY_BRANCH&quot;</span>,</span>
<span id="cb101-6"><a href="quant.html#cb101-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;MONTMORILLONITE_WYO&quot;</span>,</span>
<span id="cb101-7"><a href="quant.html#cb101-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;ILLITE_1M_RM30&quot;</span>,</span>
<span id="cb101-8"><a href="quant.html#cb101-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;CORUNDUM&quot;</span>),</span>
<span id="cb101-9"><a href="quant.html#cb101-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">std =</span> <span class="st">&quot;CORUNDUM&quot;</span>,</span>
<span id="cb101-10"><a href="quant.html#cb101-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">align =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<pre><code>## 
## -Aligning sample to the internal standard
## -Interpolating library to same 2theta scale as aligned sample
## -Optimising...
## -Removing negative coefficients and reoptimising...
## -Removing negative coefficients and reoptimising...
## -Computing phase concentrations
## -Internal standard concentration unknown. Assuming phases sum to 100 %
## ***Full pattern summation complete***</code></pre>
<p>In this case the phase specified in the <code>std</code> argument is only used for 2θ <a href="intro.html#alignment">alignment</a>, and is always included in the computed phase concentrations.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="quant.html#cb103-1" aria-hidden="true" tabindex="-1"></a>fit3<span class="sc">$</span>phases</span></code></pre></div>
<pre><code>##               phase_id    phase_name       rir phase_percent
## 1             CORUNDUM      Corundum 1.0000000       19.6679
## 2   ORDERED_MICROCLINE    K-feldspar 0.9654312        2.9718
## 3             ANDESINE   Plagioclase 0.8206422        3.6665
## 4          LABRADORITE   Plagioclase 0.8113040       16.0466
## 5 KAOLINITE_DRY_BRANCH     Kaolinite 0.5812875       11.5288
## 6       ILLITE_1M_RM30        Illite 0.2768664        6.0313
## 7  MONTMORILLONITE_WYO Smectite (Di) 0.3202779       40.0871</code></pre>
<p>Furthermore, the phase concentrations computed using this approach will always sum to 100 %.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="quant.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(fit3<span class="sc">$</span>phases<span class="sc">$</span>phase_percent)</span></code></pre></div>
<pre><code>## [1] 100</code></pre>
</div>
<div id="full-pattern-summation-with-data-harmonisation" class="section level4 hasAnchor" number="2.1.2.3">
<h4><span class="header-section-number">2.1.2.3</span> Full pattern summation with data harmonisation<a href="quant.html#full-pattern-summation-with-data-harmonisation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>It is usually recommended that the reference library used for full pattern summation is measured on the same instrument as the sample using an identical 2θ range and resolution, along with other identical configurations of the instrument. In some cases this is not feasible, and the reference library patterns may be from a different instrument to the sample. To allow for seamless use of samples and libraries from different instruments (measured using the same X-ray wavelength), <code>fps()</code> contains a logical <code>harmonise</code> argument (default <code>= TRUE</code>). When the sample and library contain non-identical 2θ axes, <code>harmonise = TRUE</code> will convert the data onto the same axis by determining the overlapping 2θ range and interpolating to the coarsest resolution available. This type of approach may produce results that are acceptable and fit for purpose, but if the best accuracy is required then a library of standard patterns collected on the instrument used to run the unknown samples is the recommended approach.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="quant.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a sample with a shorter 2theta axis than the library</span></span>
<span id="cb107-2"><a href="quant.html#cb107-2" aria-hidden="true" tabindex="-1"></a>Mix1_short <span class="ot">&lt;-</span> <span class="fu">subset</span>(rockjock_mixtures<span class="sc">$</span>Mix1, tth <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> tth <span class="sc">&lt;</span> <span class="dv">55</span>)</span>
<span id="cb107-3"><a href="quant.html#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="quant.html#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Reduce the resolution by selecting only odd rows of the data</span></span>
<span id="cb107-5"><a href="quant.html#cb107-5" aria-hidden="true" tabindex="-1"></a>Mix1_short <span class="ot">&lt;-</span> Mix1_short[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(Mix1_short), <span class="dv">2</span>),]</span>
<span id="cb107-6"><a href="quant.html#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="quant.html#cb107-7" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">fps</span>(<span class="at">lib =</span> rockjock,</span>
<span id="cb107-8"><a href="quant.html#cb107-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">smpl =</span> Mix1_short,</span>
<span id="cb107-9"><a href="quant.html#cb107-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">refs =</span> <span class="fu">c</span>(<span class="st">&quot;ORDERED_MICROCLINE&quot;</span>,</span>
<span id="cb107-10"><a href="quant.html#cb107-10" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Plagioclase&quot;</span>,</span>
<span id="cb107-11"><a href="quant.html#cb107-11" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;KAOLINITE_DRY_BRANCH&quot;</span>,</span>
<span id="cb107-12"><a href="quant.html#cb107-12" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;MONTMORILLONITE_WYO&quot;</span>,</span>
<span id="cb107-13"><a href="quant.html#cb107-13" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;ILLITE_1M_RM30&quot;</span>,</span>
<span id="cb107-14"><a href="quant.html#cb107-14" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;CORUNDUM&quot;</span>),</span>
<span id="cb107-15"><a href="quant.html#cb107-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">std =</span> <span class="st">&quot;CORUNDUM&quot;</span>,</span>
<span id="cb107-16"><a href="quant.html#cb107-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">align =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<pre><code>## 
## -Harmonising library to the same 2theta resolution as the sample
## -Aligning sample to the internal standard
## -Interpolating library to same 2theta scale as aligned sample
## -Optimising...
## -Removing negative coefficients and reoptimising...
## -Removing negative coefficients and reoptimising...
## -Computing phase concentrations
## -Internal standard concentration unknown. Assuming phases sum to 100 %
## ***Full pattern summation complete***</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="quant.html#cb109-1" aria-hidden="true" tabindex="-1"></a>fit4<span class="sc">$</span>phases</span></code></pre></div>
<pre><code>##               phase_id    phase_name       rir phase_percent
## 1             CORUNDUM      Corundum 1.0000000       19.5826
## 2   ORDERED_MICROCLINE    K-feldspar 0.9654312        3.1967
## 3             ANDESINE   Plagioclase 0.8206422        4.2983
## 4          LABRADORITE   Plagioclase 0.8113040       16.4326
## 5            ANORTHITE   Plagioclase 0.5294816        0.1007
## 6 KAOLINITE_DRY_BRANCH     Kaolinite 0.5812875       12.9506
## 7       ILLITE_1M_RM30        Illite 0.2768664        8.1800
## 8  MONTMORILLONITE_WYO Smectite (Di) 0.3202779       35.2585</code></pre>
</div>
</div>
<div id="afps" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Automated full pattern summation with <code>afps()</code><a href="quant.html#afps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/B7W5zXnlrGU" frameborder="0" allowfullscreen>
</iframe>
</p>
<p>The selection of suitable reference patterns for full pattern summation can often be challenging and time consuming. An attempt to automate this process is provided in the <code>afps()</code> function, which can select appropriate reference patterns from a reference library and subsequently exclude reference patterns based on limit of detection estimates. Such an approach is considered particularly advantageous when quantifying XRPD datasets that display considerable mineralogical variation such as the <a href="https://www.clays.org/reynolds/">Reynolds Cup</a> samples. Detailed accounts of the <code>afps()</code> function are provided in <span class="citation">Butler and Hillier (<a href="#ref-Butler2021rc" role="doc-biblioref">2021a</a>)</span> and <span class="citation">Butler and Hillier (<a href="#ref-Butler2021powdR" role="doc-biblioref">2021b</a>)</span>.</p>
<p>All of the principles and arguments outlined above for the <code>fps()</code> function apply to the use of <code>afps(). However, when using</code>afps()`, there are a few additional arguments that need to be defined:</p>
<ol style="list-style-type: decimal">
<li><code>force</code> is used to specify phase IDs (<code>lib$phases$phase_id</code>) or phase names (<code>lib$phases$phase_name</code>) that must be retained in the output, even if their concentrations are estimated to be below the limit of detection or negative.</li>
<li><code>lod</code> is used to define the limit of detection (LOD; in weight %) of the phase specified as the internal standard in the <code>std</code> argument. This limit of detection for the define phase is then used in combination with the RIRs to estimate the LODs of all other phases.</li>
<li><code>amorphous</code> is used to specify which, if any, phases should be treated as amorphous. This is used because the assumptions used to estimate the LODs of crystalline and disordered phases are not appropriate for amorphous phases.</li>
<li><code>amorphous_lod</code> is used to define the LOD (in weight %) of the phases specified in the <code>amorphous</code> argument.</li>
</ol>
<p>Here the <code>rockjock</code> library, containing 169 reference patterns, will be used to quantify one of the samples in the <code>rockjock_mixtures</code> data. Note that when using <code>afps()</code>, omission of the <code>refs</code> argument in the function call will automatically result in all phases from the reference library being used in the fitting process.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="quant.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Produce the fit</span></span>
<span id="cb111-2"><a href="quant.html#cb111-2" aria-hidden="true" tabindex="-1"></a>a_fit1 <span class="ot">&lt;-</span> <span class="fu">afps</span>(<span class="at">lib =</span> rockjock,</span>
<span id="cb111-3"><a href="quant.html#cb111-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">smpl =</span> rockjock_mixtures<span class="sc">$</span>Mix1,</span>
<span id="cb111-4"><a href="quant.html#cb111-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">std =</span> <span class="st">&quot;CORUNDUM&quot;</span>,</span>
<span id="cb111-5"><a href="quant.html#cb111-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">align =</span> <span class="fl">0.3</span>,</span>
<span id="cb111-6"><a href="quant.html#cb111-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">lod =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 
## -Using all reference patterns in the library
## -Aligning sample to the internal standard
## -Interpolating library to same 2theta scale as aligned sample
## -Applying non-negative least squares
## -Optimising...
## -Removing negative coefficients and reoptimising...
## -Calculating detection limits
## -Removing phases below detection limit
## -Reoptimising after removing crystalline phases below the limit of detection
## -Computing phase concentrations
## -Internal standard concentration unknown. Assuming phases sum to 100 %
## ***Automated full pattern summation complete***</code></pre>
<p>Once computed, the <code>afps</code> function produces a <code>powdRafps</code> object, which is a bundle of data in list format that contains the outputs (see <code>?afps.powdRlib</code>). When large libraries such a <code>rockjock</code> are used to quantify a given sample, the resulting output is likely contain several different reference patterns for a given mineral, for example:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="quant.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(a_fit1<span class="sc">$</span>phases<span class="sc">$</span>phase_name)</span></code></pre></div>
<pre><code>## 
##    Background      Corundum        Illite    K-feldspar     Kaolinite 
##             1             1             2             1             1 
##   Plagioclase Smectite (Di) 
##             3             2</code></pre>
<p>Illustrates that the resulting output contains 2 reference patterns for both illite and smectite, 3 patterns for plagioclase, and 1 pattern for each of the other phases selected by <code>afps()'. This information is grouped together and summed in the</code>phases_grouped<code>data frame within the</code>powdRafps` object:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="quant.html#cb115-1" aria-hidden="true" tabindex="-1"></a>a_fit1<span class="sc">$</span>phases_grouped</span></code></pre></div>
<pre><code>##      phase_name phase_percent
## 1      Corundum       19.2449
## 2    Background        0.0001
## 3    K-feldspar        2.6398
## 4   Plagioclase       19.2431
## 5     Kaolinite       10.8828
## 6 Smectite (Di)       40.0788
## 7        Illite        7.9105</code></pre>
<p>Grouping of phases like this is a powerful approach to obtain better fits to the minerals present in a given sample, and is advantageous even for minerals like quartz, where some combination of several quartz standards may produce a better fit that a single standard. Note also that the “background” phase in the output is simply a horizontal line that can account for shifts in background intensity, which can be useful to use in some cases, but most especially when working with data and libraries from different instruments. In the <code>rockjock</code> data, the background patterns have been given an exceptionally high RIR so that their quantified concentrations are effectively zero.</p>
</div>
<div id="additional-fps-and-afps-functionality" class="section level3 hasAnchor" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> Additional <code>fps()</code> and <code>afps()</code> functionality<a href="quant.html#additional-fps-and-afps-functionality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="shifting-of-reference-patterns" class="section level4 hasAnchor" number="2.1.4.1">
<h4><span class="header-section-number">2.1.4.1</span> Shifting of reference patterns<a href="quant.html#shifting-of-reference-patterns" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Both <code>fps()</code> and <code>afps()</code> accept a <code>shift</code> argument, which when set to a value greater than zero results in optimisation of a small 2θ shift for each reference pattern in order to improve the quality of the fit. The value supplied to the <code>shift</code> argument defines the maximum (either positive or negative) shift that can be applied to each reference pattern before the shift is reset to zero.</p>
<p>This shifting process is designed to correct for small linear differences in the peak positions of the standards relative to the sample, which may result from a combination of instrumental aberrations, mineralogical variation and/or uncorrected errors in the library patterns. Whilst it provides more accurate results, the process can substantially increase computation time.</p>
</div>
<div id="regrouping-phases-in-powdrfps-and-powdrafps-objects" class="section level4 hasAnchor" number="2.1.4.2">
<h4><span class="header-section-number">2.1.4.2</span> Regrouping phases in <code>powdRfps</code> and <code>powdRafps</code> objects<a href="quant.html#regrouping-phases-in-powdrfps-and-powdrafps-objects" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Occasionally it can be useful to apply a different grouping structure to the phases quantified within a <code>powdRfps</code> or <code>powdRafps</code> object. This can be achieved using the <code>regroup</code> function (see <code>?regroup.powdRfps</code> and <code>?regroup.powdRafps</code>):</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="quant.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the rockjock regrouping structure</span></span>
<span id="cb117-2"><a href="quant.html#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(rockjock_regroup)</span>
<span id="cb117-3"><a href="quant.html#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="quant.html#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Check the first 6 rows of the data</span></span>
<span id="cb117-5"><a href="quant.html#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rockjock_regroup)</span></code></pre></div>
<pre><code>##                  phase_id phase_name_grouped phase_name_grouped2
## 1                CORUNDUM           Corundum            Non-clay
## 2                BACK_POS         Background          Background
## 3                BACK_NEG         Background          Background
## 4                  QUARTZ             Quartz            Non-clay
## 5      ORDERED_MICROCLINE         K-feldspar            Non-clay
## 6 INTERMEDIATE_MICROCLINE         K-feldspar            Non-clay</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="quant.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Regroup the data in a_fit1 using the coarsest resolution</span></span>
<span id="cb119-2"><a href="quant.html#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="co">#(i.e. select columns 1 and 3 from the data)</span></span>
<span id="cb119-3"><a href="quant.html#cb119-3" aria-hidden="true" tabindex="-1"></a>a_fit1_rg <span class="ot">&lt;-</span> <span class="fu">regroup</span>(a_fit1, rockjock_regroup[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)])</span>
<span id="cb119-4"><a href="quant.html#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="quant.html#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Check the changes made to the data</span></span>
<span id="cb119-6"><a href="quant.html#cb119-6" aria-hidden="true" tabindex="-1"></a>a_fit1_rg<span class="sc">$</span>phases</span></code></pre></div>
<pre><code>##                 phase_id phase_name          rir phase_percent
## 1               CORUNDUM   Non-clay 1.000000e+00       19.2449
## 2               BACK_NEG Background 1.000000e+04        0.0001
## 3     ORDERED_MICROCLINE   Non-clay 9.654312e-01        2.6398
## 4               ANDESINE   Non-clay 8.206422e-01        3.2496
## 5            LABRADORITE   Non-clay 8.113040e-01       15.8851
## 6              BYTOWNITE   Non-clay 7.250736e-01        0.1084
## 7          ORD_KAOLINITE       Clay 6.684230e-01       10.8828
## 8     CA_MONTMORILLONITE       Clay 2.920099e-01       16.1587
## 9         ILLITE_1M_RM30       Clay 2.768664e-01        4.9353
## 10   MONTMORILLONITE_WYO       Clay 3.202779e-01       23.9201
## 11 ILLITE_R0_5_PERCENT_I       Clay 2.620735e-01        2.9752</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="quant.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check the new grouped data</span></span>
<span id="cb121-2"><a href="quant.html#cb121-2" aria-hidden="true" tabindex="-1"></a>a_fit1_rg<span class="sc">$</span>phases_grouped</span></code></pre></div>
<pre><code>##   phase_name phase_percent
## 1 Background        0.0001
## 2       Clay       58.8721
## 3   Non-clay       41.1278</code></pre>
</div>
</div>
</div>
<div id="plotting-powdrfps-and-powdrafps-objects" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Plotting <code>powdRfps</code> and <code>powdRafps</code> objects<a href="quant.html#plotting-powdrfps-and-powdrafps-objects" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/XEw-KHov2mI" frameborder="0" allowfullscreen>
</iframe>
</p>
<p>Plotting results <code>powdRfps</code> and <code>powdRafps</code> objects, derived from <code>fps()</code> and <code>afps()</code>, respectively, is achieved using <code>plot()</code> (see <code>?plot.powdRfps</code> and <code>?plot.powdRafps</code>).</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="quant.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a_fit1, <span class="at">wavelength =</span> <span class="st">&quot;Cu&quot;</span>, <span class="at">interactive =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-63"></span>
<img src="DigiMinR_files/figure-html/unnamed-chunk-63-1.png" alt="Example output from plotting a powdRfps or powdRafps object." width="672" />
<p class="caption">
Figure 2.2: Example output from plotting a powdRfps or powdRafps object.
</p>
</div>
<p>When plotting <code>powdRfps</code> or <code>powdRafps</code> objects the wavelength must be defined because it is required to compute d-spacings that are shown when <code>interactive = TRUE</code>. As with other plotting methods outlined in Section <a href="intro.html#plotting-data">1.3</a>, interactive <code>ggplotly()</code> outputs can be created using <code>interactive = TRUE</code>.</p>
<p>In addition to above, plotting for <code>powdRfps</code> and <code>powdRafps</code> objects can be further adjusted by the <code>group</code>, <code>mode</code> and <code>xlim</code> arguments. When the <code>group</code> argument is set to <code>TRUE</code>, the patterns within the fit are grouped and summed according to phase names, which can help simplify the plot:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="quant.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a_fit1, <span class="at">wavelength =</span> <span class="st">&quot;Cu&quot;</span>,</span>
<span id="cb124-2"><a href="quant.html#cb124-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">group =</span> <span class="cn">TRUE</span>,</span>
<span id="cb124-3"><a href="quant.html#cb124-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">interactive =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-64"></span>
<img src="DigiMinR_files/figure-html/unnamed-chunk-64-1.png" alt="Plotting a powdRfps or powdRafps object with the reference patterns grouped." width="672" />
<p class="caption">
Figure 2.3: Plotting a powdRfps or powdRafps object with the reference patterns grouped.
</p>
</div>
<p>The <code>mode</code> argument can be one of <code>"fit"</code> (the default), <code>"residuals"</code> or <code>"both"</code>, for example:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="quant.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a_fit1, <span class="at">wavelength =</span> <span class="st">&quot;Cu&quot;</span>,</span>
<span id="cb125-2"><a href="quant.html#cb125-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">mode =</span> <span class="st">&quot;residuals&quot;</span>,</span>
<span id="cb125-3"><a href="quant.html#cb125-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">interactive =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-65"></span>
<img src="DigiMinR_files/figure-html/unnamed-chunk-65-1.png" alt="Plotting the residuals of a powdRfps or powdRafps object." width="672" />
<p class="caption">
Figure 2.4: Plotting the residuals of a powdRfps or powdRafps object.
</p>
</div>
<p>or alternatively both the fit and residuals can be plotted using <code>mode = "both"</code> and the 2θ axis restricted using the <code>xlim</code> argument:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="quant.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a_fit1, <span class="at">wavelength =</span> <span class="st">&quot;Cu&quot;</span>,</span>
<span id="cb126-2"><a href="quant.html#cb126-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">mode =</span> <span class="st">&quot;both&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">30</span>),</span>
<span id="cb126-3"><a href="quant.html#cb126-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">interactive =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-66"></span>
<img src="DigiMinR_files/figure-html/unnamed-chunk-66-1.png" alt="Plotting both the fit and residuals of a powdRfps or powdRafps object." width="672" />
<p class="caption">
Figure 2.5: Plotting both the fit and residuals of a powdRfps or powdRafps object.
</p>
</div>
</div>
<div id="quantifying-multiple-samples" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Quantifying multiple samples<a href="quant.html#quantifying-multiple-samples" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/baUcGgkdzZM" frameborder="0" allowfullscreen>
</iframe>
</p>
<div id="lapply" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> <code>lapply()</code><a href="quant.html#lapply" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The simplest way to quantify multiple samples via either <code>fps()</code> and <code>afps()</code> is by wrapping either of the functions in <code>lapply()</code> and supplying a list of diffractograms. The following example wraps the <code>fps()</code> function in <code>lapply</code> and applies the function to the first three items within the <code>rockjock_mixtures</code> data.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="quant.html#cb127-1" aria-hidden="true" tabindex="-1"></a>multi_fit <span class="ot">&lt;-</span> <span class="fu">lapply</span>(rockjock_mixtures[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], fps,</span>
<span id="cb127-2"><a href="quant.html#cb127-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">lib =</span> rockjock,</span>
<span id="cb127-3"><a href="quant.html#cb127-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">std =</span> <span class="st">&quot;CORUNDUM&quot;</span>,</span>
<span id="cb127-4"><a href="quant.html#cb127-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">refs =</span> <span class="fu">c</span>(<span class="st">&quot;ORDERED_MICROCLINE&quot;</span>,</span>
<span id="cb127-5"><a href="quant.html#cb127-5" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;LABRADORITE&quot;</span>,</span>
<span id="cb127-6"><a href="quant.html#cb127-6" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;KAOLINITE_DRY_BRANCH&quot;</span>,</span>
<span id="cb127-7"><a href="quant.html#cb127-7" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;MONTMORILLONITE_WYO&quot;</span>,</span>
<span id="cb127-8"><a href="quant.html#cb127-8" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;ILLITE_1M_RM30&quot;</span>,</span>
<span id="cb127-9"><a href="quant.html#cb127-9" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;CORUNDUM&quot;</span>,</span>
<span id="cb127-10"><a href="quant.html#cb127-10" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;QUARTZ&quot;</span>),</span>
<span id="cb127-11"><a href="quant.html#cb127-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">align =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<pre><code>## 
## -Aligning sample to the internal standard
## -Interpolating library to same 2theta scale as aligned sample
## -Optimising...
## -Computing phase concentrations
## -Internal standard concentration unknown. Assuming phases sum to 100 %
## ***Full pattern summation complete***
## 
## -Aligning sample to the internal standard
## -Interpolating library to same 2theta scale as aligned sample
## -Optimising...
## -Computing phase concentrations
## -Internal standard concentration unknown. Assuming phases sum to 100 %
## ***Full pattern summation complete***
## 
## -Aligning sample to the internal standard
## -Interpolating library to same 2theta scale as aligned sample
## -Optimising...
## -Removing negative coefficients and reoptimising...
## -Computing phase concentrations
## -Internal standard concentration unknown. Assuming phases sum to 100 %
## ***Full pattern summation complete***</code></pre>
<p>When using <code>lapply</code> in this way, the names of the items within the list or <a href="intro.html#loading-data"><code>multiXY</code> object</a> supplied to the function are inherited by the output:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="quant.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">names</span>(rockjock_mixtures[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]),</span>
<span id="cb129-2"><a href="quant.html#cb129-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">names</span>(multi_fit))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="parallel-processing" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Parallel processing<a href="quant.html#parallel-processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Whilst <code>lapply</code> is a simple way to quantify multiple samples, the computation remains restricted to a single core. Computation time can be reduced many-fold by allowing different cores of your machine to process one sample at a time, which can be achieved using the <code>doParallel</code> and <code>foreach</code> packages:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="quant.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Install the foreach and doParallel package</span></span>
<span id="cb131-2"><a href="quant.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;foreach&quot;</span>, <span class="st">&quot;doParallel&quot;</span>))</span>
<span id="cb131-3"><a href="quant.html#cb131-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-4"><a href="quant.html#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co">#load the packages</span></span>
<span id="cb131-5"><a href="quant.html#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreach)</span>
<span id="cb131-6"><a href="quant.html#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb131-7"><a href="quant.html#cb131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-8"><a href="quant.html#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Detect number of cores on machine</span></span>
<span id="cb131-9"><a href="quant.html#cb131-9" aria-hidden="true" tabindex="-1"></a>UseCores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>()</span>
<span id="cb131-10"><a href="quant.html#cb131-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-11"><a href="quant.html#cb131-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Register the cluster using n - 1 cores </span></span>
<span id="cb131-12"><a href="quant.html#cb131-12" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(UseCores<span class="dv">-1</span>)</span>
<span id="cb131-13"><a href="quant.html#cb131-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-14"><a href="quant.html#cb131-14" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb131-15"><a href="quant.html#cb131-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-16"><a href="quant.html#cb131-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Use foreach loop and %dopar% to compute in parallel</span></span>
<span id="cb131-17"><a href="quant.html#cb131-17" aria-hidden="true" tabindex="-1"></a>multi_fit <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%dopar%</span></span>
<span id="cb131-18"><a href="quant.html#cb131-18" aria-hidden="true" tabindex="-1"></a>  (powdR<span class="sc">::</span><span class="fu">fps</span>(<span class="at">lib =</span> rockjock,</span>
<span id="cb131-19"><a href="quant.html#cb131-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">smpl =</span> rockjock_mixtures[[i]],</span>
<span id="cb131-20"><a href="quant.html#cb131-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">std =</span> <span class="st">&quot;CORUNDUM&quot;</span>,</span>
<span id="cb131-21"><a href="quant.html#cb131-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">refs =</span> <span class="fu">c</span>(<span class="st">&quot;ORDERED_MICROCLINE&quot;</span>,</span>
<span id="cb131-22"><a href="quant.html#cb131-22" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;LABRADORITE&quot;</span>,</span>
<span id="cb131-23"><a href="quant.html#cb131-23" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;KAOLINITE_DRY_BRANCH&quot;</span>,</span>
<span id="cb131-24"><a href="quant.html#cb131-24" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;MONTMORILLONITE_WYO&quot;</span>,</span>
<span id="cb131-25"><a href="quant.html#cb131-25" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;ILLITE_1M_RM30&quot;</span>,</span>
<span id="cb131-26"><a href="quant.html#cb131-26" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;CORUNDUM&quot;</span>,</span>
<span id="cb131-27"><a href="quant.html#cb131-27" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;QUARTZ&quot;</span>),</span>
<span id="cb131-28"><a href="quant.html#cb131-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">align =</span> <span class="fl">0.3</span>))</span>
<span id="cb131-29"><a href="quant.html#cb131-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-30"><a href="quant.html#cb131-30" aria-hidden="true" tabindex="-1"></a><span class="co">#name the items in the aquant_parallel list</span></span>
<span id="cb131-31"><a href="quant.html#cb131-31" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(multi_fit) <span class="ot">&lt;-</span> <span class="fu">names</span>(rockjock_mixtures)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb131-32"><a href="quant.html#cb131-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-33"><a href="quant.html#cb131-33" aria-hidden="true" tabindex="-1"></a><span class="co">#stop the cluster</span></span>
<span id="cb131-34"><a href="quant.html#cb131-34" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code></pre></div>
<p>Note how the call to <code>fps</code> uses the notation <code>powdR::fps()</code>, which specifies the accessing of the <code>fps()</code> function from the <strong>powdR</strong> package.</p>
</div>
</div>
<div id="summarising-mineralogy" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Summarising mineralogy<a href="quant.html#summarising-mineralogy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When multiple samples are quantified it is often useful to report the phase concentrations of all of the samples in a single table. For a given list of <code>powdRfps</code> and/or <code>powdRafps</code> objects, the <code>summarise_mineralogy()</code> function yields such summary tables, for example:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="quant.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise_mineralogy</span>(multi_fit, <span class="at">type =</span> <span class="st">&quot;grouped&quot;</span>, <span class="at">order =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##   sample_id Kaolinite Corundum Plagioclase Smectite (Di)  Illite K-feldspar
## 1      Mix1   11.4255  19.6390     18.9222       40.2223  6.0943     3.4771
## 2      Mix2   19.9893  20.1257     34.2955        3.1401  9.8914     7.9668
## 3      Mix3   38.0548  20.1476          NA        3.5897 19.4220    11.0541
##   Quartz
## 1 0.2197
## 2 4.5911
## 3 7.7318</code></pre>
<p>where <code>type = "grouped"</code> denotes that phases with the same <code>phase_name</code> will be summed together, and <code>order = TRUE</code> specifies that the columns will be ordered from most common to least common (assessed by the sum of each column). Using <code>type = "all"</code> instead would result in tabulation of all phase IDs.</p>
<p>In addition to the quantitative mineral data, three objective parameters that summarise the quality of the fit can be appended to the table via the logical <code>rwp</code>, <code>r</code> and <code>delta</code> arguments.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="quant.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise_mineralogy</span>(multi_fit, <span class="at">type =</span> <span class="st">&quot;grouped&quot;</span>, <span class="at">order =</span> <span class="cn">TRUE</span>,</span>
<span id="cb134-2"><a href="quant.html#cb134-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">rwp =</span> <span class="cn">TRUE</span>, <span class="at">r =</span> <span class="cn">TRUE</span>, <span class="at">delta =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##   sample_id Kaolinite Corundum Plagioclase Smectite (Di)  Illite K-feldspar
## 1      Mix1   11.4255  19.6390     18.9222       40.2223  6.0943     3.4771
## 2      Mix2   19.9893  20.1257     34.2955        3.1401  9.8914     7.9668
## 3      Mix3   38.0548  20.1476          NA        3.5897 19.4220    11.0541
##   Quartz       Rwp         R    Delta
## 1 0.2197 0.1193771 0.1165048 39834.67
## 2 4.5911 0.1237287 0.1115322 36910.18
## 3 7.7318 0.1141585 0.1077551 37571.72</code></pre>
<p>For each of these parameters, lower values represent a smaller difference between the measured and fitted patterns, and hence are indicative of a better fit. For more information see Section 2.1 in <span class="citation">Butler and Hillier (<a href="#ref-Butler2021powdR" role="doc-biblioref">2021b</a>)</span>.</p>
</div>
<div id="the-powdr-shiny-app" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> The powdR Shiny app<a href="quant.html#the-powdr-shiny-app" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>All above examples showcase the use of R code to carry out full pattern summation. It is also possible to run much of this functionality of <strong>powdR</strong> via a Shiny web application. This Shiny app can be loaded in your default web browser by running <code>run_powdR()</code>. The resulting application has six tabs:</p>
<ol style="list-style-type: decimal">
<li><strong>Reference Library Builder:</strong> Allows you to create and export a <a href="quant.html#powdRlib"><code>powdRlib</code> reference library</a> from two ‘.csv’ files: one for the XRPD measurements, and the other for the ID, name and reference intensity ratio of each pattern.</li>
<li><strong>Reference Library Viewer:</strong> Facilitates quick inspection of the phases within a <code>powdRlib</code> reference library.</li>
<li><strong>Reference Library Editor:</strong> Allows the user to easily subset a <code>powdRlib</code> reference library .</li>
<li><strong>Full Pattern Summation:</strong> A user friendly interface for iterative full pattern summation of single samples using <code>fps()</code> or <code>afps()</code>.</li>
<li><strong>Results Viewer/Editor:</strong> Allows for results from previously saved <code>powdRfps</code> and <code>powdRafps</code> objects to be viewed and edited via addition or removal of reference patterns.</li>
<li><strong>Help</strong> Provides a series of video tutorials (via YouTube) detailing the use of the <strong>powdR</strong> Shiny application.</li>
</ol>
<p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/dDd6cr8kpTc" frameborder="0" allowfullscreen>
</iframe>
</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Butler2021rc" class="csl-entry">
Butler, Benjamin M, and Stephen Hillier. 2021a. <span>“<span>AUTOMATED FULL-PATTERN SUMMATION OF X-RAY POWDER DIFFRACTION DATA FOR HIGH-THROUGHPUT QUANTIFICATION OF CLAY-BEARING MIXTURES</span>.”</span> <em>Clays and Clay Minerals</em>. <a href="https://doi.org/10.1007/s42860-020-00105-6">https://doi.org/10.1007/s42860-020-00105-6</a>.
</div>
<div id="ref-Butler2021powdR" class="csl-entry">
———. 2021b. <span>“<span class="nocase">powdR:An R package for quantitative mineralogy using full pattern summation of X-ray powder diffraction data</span>.”</span> <em>Computers and Geosciences</em> 147: 104662. <a href="https://doi.org/10.1016/j.cageo.2020.104662">https://doi.org/10.1016/j.cageo.2020.104662</a>.
</div>
<div id="ref-Eberl2003" class="csl-entry">
Eberl, D. D. 2003. <span>“<span class="nocase">User’s guide to ROCKJOCK - A program for determining quantitative mineralogy from powder X-ray diffraction data</span>.”</span> Boulder, CA: USGS.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="machine-learning.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
